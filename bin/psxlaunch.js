#! /usr/bin/env node  
!function(s){"use strict";function e(){return xt.__string_rec(this,"")}var t,f=f||{};function i(t,e){var i,s=Object.create(t);for(i in e)s[i]=e[i];return e.toString!==Object.prototype.toString&&(s.toString=e.toString),s}function c(t,e){this.r=new RegExp(t,e.split("u").join(""))}c.__name__="EReg",c.prototype={match:function(t){return this.r.global&&(this.r.lastIndex=0),this.r.m=this.r.exec(t),this.r.s=t,null!=this.r.m},matched:function(t){if(null!=this.r.m&&0<=t&&t<this.r.m.length)return this.r.m[t];throw ct.thrown("EReg::matched")},matchedPos:function(){if(null==this.r.m)throw ct.thrown("No string matched");return{pos:this.r.m.index,len:this.r.m[0].length}},matchSub:function(t,e,i){var s;return null==i&&(i=-1),this.r.global?(this.r.lastIndex=e,this.r.m=this.r.exec(i<0?t:w.substr(t,0,e+i)),(s=null!=this.r.m)&&(this.r.s=t)):(s=this.match(i<0?w.substr(t,e,null):w.substr(t,e,i)))&&(this.r.s=t,this.r.m.index+=e),s},map:function(t,e){for(var i=0,s="";!(i>=t.length);){if(!this.matchSub(t,i)){s+=v.string(w.substr(t,i,null));break}var n=this.matchedPos();if(s+=v.string(w.substr(t,i,n.pos-i)),s+=v.string(e(this)),i=0==n.len?(s+=v.string(w.substr(t,n.pos,1)),n.pos+1):n.pos+n.len,!this.r.global)break}return!this.r.global&&0<i&&i<t.length&&(s+=v.string(w.substr(t,i,null))),s},__class__:c};function u(){this.mountedPath=null,this.index=-1,this.ERROR=null,this.flag_use_altsave=!1,this.path_med_saves="",this.path_med_states="",this.cfg={path_iso:"",path_mednafen:"",path_savedir:"",path_autorun:"",terminal_size:"",pismo_enable:!1,autosave:!1,mednafen_states:"mcs",mednafen_saves:"sav"};var t=new mt;t.h.bilinear="psx.videoip-1-0|1|x|y",t.h.stretch="psx.stretch-aspect_mult2-0|full|aspect|aspect_int|aspect_mult2",t.h.shader="psx.shader-none-none|autoip|autoipsharper|scale2x|sabr|ipsharper|ipxnoty|ipynotx|ipxnotysharper|ipynotxsharper|goat",t.h.special="psx.special-none-none|hq2x|hq3x|hq4x|scale2x|scale3x|scale4x|2xsai|super2xsai|supereagle|nn2x|nn3x|nn4x|nny2x|nny3x|nny4x",t.h.fs="video.fs-1",t.h.blur="psx.tblur-0",t.h.widen="psx.sc_widen-0",t.h.wsc="psx.sc_win-3",t.h.fsc="psx.sc_fs-2",this.SETTING=t}u.__name__="Engine",u.getConfigFullpath=function(){return r.app.getAppPathJoin(u.file_config)},u.NPM_install=function(){var t=kt.dirname(__filename),e=kt.join(t,u.file_config),i=kt.join(t,u.file_config_empty);return!St.existsSync(e)&&(I.copyFileSync(i,e),!0)},u.prototype={init:function(){F.FLAG_LOG_QUIET=!1;try{this._load_parse_config(),this._scan_iso_dir(),this._check_autorun(),this._get_psxcfg()}catch(t){var e=ct.caught(t).unwrap();if("string"==typeof e){this.ERROR=e}else{if(!(e instanceof Error))throw t;this.ERROR="Generic filesystem Error"}}return null==this.ERROR},_load_parse_config:function(){var t;try{t=new b(St.readFileSync(r.app.getAppPathJoin(u.file_config),{encoding:"utf8"}))}catch(t){throw ct.thrown("Config file Read/Parse Error")}var e=t.data.h.settings;if(null==e)throw ct.thrown("Config File does not have a [settings] section");function i(t){return kt.normalize(e.h[t])}if(this.cfg.path_iso=i("isos"),this.cfg.path_mednafen=i("mednafen"),this.cfg.path_savedir=i("savedir"),this.cfg.path_autorun=i("autorun"),this.cfg.mednafen_saves=i("mednafen_saves"),this.cfg.mednafen_states=i("mednafen_states"),this.cfg.terminal_size=e.h.size,this.cfg.autosave=1==v.parseInt(e.h.autosave),this.cfg.pismo_enable=1==v.parseInt(e.h.pismo_enable),this.cfg.path_iso.length<2)throw ct.thrown("ISOPATH not set");if(this.cfg.path_mednafen.length<2)throw ct.thrown("MEDNAFEN PATH not set");if(!I.pathExists(this.cfg.path_iso))throw ct.thrown('ISOPATH "'+this.cfg.path_iso+'" does not exist');if(!I.pathExists(this.cfg.path_mednafen))throw ct.thrown('MEDNAFEN PATH "'+this.cfg.path_mednafen+'" does not exist');if(!I.pathExists(kt.join(this.cfg.path_mednafen,u.MEDNAFEN_EXE)))throw ct.thrown("Can't find \""+u.MEDNAFEN_EXE+'" in "'+this.cfg.path_mednafen+'"');this.path_med_saves=kt.resolve(this.cfg.path_mednafen,this.cfg.mednafen_saves),this.path_med_states=kt.resolve(this.cfg.path_mednafen,this.cfg.mednafen_states),this.flag_use_altsave=1<this.cfg.path_savedir.length,this.flag_use_altsave&&I.createRecursiveDir(this.cfg.path_savedir)},_scan_iso_dir:function(){this.ar_games=[];var t=[],e=u.ext_normal;this.cfg.pismo_enable&&(e=e.concat(u.ext_mountable));for(var i=I.getFileListFromDirR(this.cfg.path_iso,e),s=0;s<i.length;){var n=i[s];++s;var r={name:kt.basename(n,kt.extname(n)),path:n,ext:I.getFileExt(n),isZIP:!1};this.ar_games.push(r),".m3u"==r.ext&&t.push(n)}for(s=0;s<t.length;){n=t[s];++s;for(var o=St.readFileSync(n).toString().split(Tt.EOL),a=0;a<o.length;){var l=o[a];++a;for(var h=this.ar_games.length;0<=--h;)this.ar_games[h].name==kt.basename(l,kt.extname(l))&&this.ar_games.splice(h,1)}}this.ar_games.sort(function(t,e){return w.cca(t.name.toLowerCase(),0)-w.cca(e.name.toLowerCase(),0)})},_check_autorun:function(){var s,n=this;this.cfg.path_autorun.length<2||(s=kt.basename(this.cfg.path_autorun),0==C.getTaskPIDs(s).length?F.quickExec("START /I "+this.cfg.path_autorun,null,function(t,e,i){n.OPLOG='Launched "'+s+'" [OK]'}):this.OPLOG='"'+s+'" Already running')},_get_psxcfg:function(){var i=this;this.psxcfg=new y(kt.join(this.cfg.path_mednafen,u.PSX_CFG));this.psxcfg.load();function t(t,e){i.psxcfg.get(t)!=e&&(i.psxcfg.set(t,e),s=!0)}var s=!1;if(t("filesys.fname_state","%f.%X"),t("filesys.fname_sav","%F.%x"),this.flag_use_altsave&&(t("filesys.path_state",this.cfg.path_savedir),t("filesys.path_sav",this.cfg.path_savedir)),s&&!this.psxcfg.save())throw ct.thrown("Cannot write to 'psx.cfg', do you have write access?")},prepareGame:function(t){this.index=t,this.current=this.ar_games[this.index],this.current.isZIP=0<=u.ext_mountable.indexOf(this.current.ext),this.getLocalSaves(t),this.getRamSaves(t)},launchGame:function(){if(this.current.isZIP){if(this.mountedPath=O.mount(this.current.path),null==this.mountedPath)return!(this.ERROR="Could not mount game");var t=null,e=0,i=I.getFileListFromDir(this.mountedPath);t:for(;e<i.length;){var s=i[e];switch(++e,I.getFileExt(s)){case".cue":t=s;break;case".m3u":t=s;break t}}if(null==t)return this.ERROR="No '.cue|.m3u' files found",O.unmount(this.mountedPath),!1;this.startMednafen(kt.join(this.mountedPath,t))}else this.mountedPath=null,this.startMednafen(this.current.path);return!0},copySave_Pull:function(){if(0!=this.saves_med.length){for(var t=0,e=this.saves_med.length,i=0,s=this.saves_med;i<s.length;){var n=s[i];++i;var r=kt.join(this.cfg.path_savedir,kt.basename(n));I.pathExists(r)||(I.copyFileSync(n,r),++t)}this.OPLOG="Copied ("+t+"/"+e+") saves to current Save dir"}},copySave_Push:function(){if(0!=this.saves_ram.length){for(var t=0,e=this.saves_ram.length,i=0,s=this.saves_ram;i<s.length;){var n,r=s[i];++i,n=".mcr"==I.getFileExt(r)?kt.join(this.path_med_saves,kt.basename(r)):kt.join(this.path_med_states,kt.basename(r)),I.pathExists(n)&&this.filesAreSame(r,n)||(I.copyFileSync(r,n),++t)}this.OPLOG="Copied ("+t+"/"+e+") saves to Mednafen DB"}},getLocalSaves:function(t){this.saves_med=[],this.saves_med_states=[];var e=kt.join(this.path_med_saves,this.ar_games[t].name+".0.mcr");I.pathExists(e)&&this.saves_med.push(e);e=kt.join(this.path_med_saves,this.ar_games[t].name+".1.mcr");I.pathExists(e)&&this.saves_med.push(e);for(var i=0;i<10;){var s=i++,e=kt.join(this.path_med_states,this.ar_games[t].name+".mc"+s);I.pathExists(e)&&(this.saves_med.push(e),this.saves_med_states.push(e))}},getRamSaves:function(t){if(this.saves_ram=[],this.saves_ram_states=[],this.flag_use_altsave){var e=kt.join(this.cfg.path_savedir,this.ar_games[t].name+".0.mcr");I.pathExists(e)&&this.saves_ram.push(e);e=kt.join(this.cfg.path_savedir,this.ar_games[t].name+".1.mcr");I.pathExists(e)&&this.saves_ram.push(e);for(var i=0;i<10;){var s=i++,e=kt.join(this.cfg.path_savedir,this.ar_games[t].name+".mc"+s);I.pathExists(e)&&(this.saves_ram.push(e),this.saves_ram_states.push(e))}}},filesAreSame:function(t,e){return I.getFileMD5(t)==I.getFileMD5(e)},startMednafen:function(t){var s=this;F.quickExec(u.MEDNAFEN_EXE+' "'+t+'"',this.cfg.path_mednafen,function(t,e,i){null!=s.mountedPath&&O.unmount(s.mountedPath),null!=s.onMednafenExit&&s.onMednafenExit()})},anySavesRAM:function(){return 0<this.saves_ram.length},anySavesLOCAL:function(){return 0<this.saves_med.length},getGameNames:function(){for(var t=[],e=0,i=this.ar_games;e<i.length;){var s=i[e];++e,t.push(s.name)}return t},setting_get:function(t){var e=this.SETTING.h[t].split("-"),i=this.psxcfg.get(e[0]);return null==i?e[1]:i},setting_set:function(t,e){var i=this.SETTING.h[t].split("-");this.psxcfg.set(i[0],e)},settings_save:function(){return this.psxcfg.save()},setting_process:function(){var t=parseFloat(this.psxcfg.data.psx.sc_widen),e=parseFloat(this.psxcfg.data.psx.sc_win),i=parseFloat(this.psxcfg.data.psx.sc_fs),s=1+.5*t;this.psxcfg.set("psx.xscale",""+e*s),this.psxcfg.set("psx.yscale",""+e),this.psxcfg.set("psx.xscalefs",""+i*s),this.psxcfg.set("psx.yscalefs",""+i)},deleteSave:function(t){var e;switch(this.OPLOG=null,t){case"all":e=this.saves_ram.concat(this.saves_med);break;case"states_med":e=this.saves_med_states;break;case"states_sec":e=this.saves_ram_states;break;default:return}for(var i=0,s=0;s<e.length;){var n=e[s];++s,St.unlinkSync(n),++i}this.OPLOG="Deleted ("+i+") saves"},saveArGetStates:function(t,e){null==e&&(e=!1);for(var i=[],s=t.length;0<=--s;)new c("(.*\\d)$","i").match(t[s])&&(i.push(t[s]),e&&t.splice(s,1));return i},__class__:u};var w=function(){};w.__name__="HxOverrides",w.cca=function(t,e){var i=t.charCodeAt(e);if(i==i)return i},w.substr=function(t,e,i){if(null==i)i=t.length;else if(i<0){if(0!=e)return"";i=t.length+i}return t.substr(e,i)},w.remove=function(t,e){var i=t.indexOf(e);return-1!=i&&(t.splice(i,1),!0)},w.now=function(){return Date.now()};var r=function(){this.argsAction=null,this.argsOptions={},this.argsOutput=null,this.argsInput=[],this.ARGS={inputRule:"no",outputRule:"no",requireAction:!1,supportWildcards:!0,helpInput:null,helpOutput:null,helpText:null,Actions:[],Options:[]},this.PROGRAM_INFO={name:"CLI Application",version:"0.1"},this.HELP_MARGIN=16;var e=this;(r.app=this).set_FLAG_USE_SLASH_FOR_OPTION(!1),D.init(),r.TERMINAL=new A,this.T=r.TERMINAL,process.once("exit",function(t){D.log("==> [EXIT] with code "+t),e.onExit(t)}),process.once("SIGINT",function(){process.exit(1223)});try{this.init()}catch(i){if("string"!=typeof(s=ct.caught(i).unwrap()))throw i;var t=s;this.printBanner(!0),"HELP"==t&&(this.printHelp(),process.exit(0)),this.exitError(t,!0)}D.log("- Inputs : "+this.argsInput.join(", ")),D.log("- Output : "+this.argsOutput),D.log("- Action  set : "+this.argsAction),D.log("- Options set : ");for(var i=0,s=_.fields(this.argsOptions);i<s.length;){var n=s[i];++i,D.log("\t\t"+n+" : "+v.string(_.getProperty(this.argsOptions,n)))}D.log(x.rep(40,"─")),process.nextTick(Dt(this,this.onStart))};r.__name__="djNode.BaseApp",r.prototype={set_FLAG_USE_SLASH_FOR_OPTION:function(t){return this.FLAG_USE_SLASH_FOR_OPTION=t,this._sb=t?["/","?"]:["-","help"],t},init:function(){this.T;process.stdout.write("[0m"),this.ARGS.Options.unshift(["o","-output","yes"]);var t=this.PROGRAM_INFO,e=this.ARGS;null==t.executable&&(t.executable=kt.basename(__filename)),D.log("Creating Application [ "+t.name+" ,v"+t.version+" ]");for(var i,s=0,n=process.argv.slice(2);null!=(i=n[s++]);)if(i.charAt(0)!=this._sb[0]){var r=this.getArgAction(i);if(null==r)this.argsInput.push(i);else{if(null!=this.argsAction)throw ct.thrown("You can only set one <action>");this.argsAction=r[0]}}else{if(1==i.toLowerCase().indexOf(this._sb[1]))throw ct.thrown("HELP");if(null==(u=this.getArgOption(w.substr(i,1,null))))throw ct.thrown("Illegal argument ["+i+"]");if(null!=u[2]){var o=n[s++];if(null==o||null!=this.getArgOption(o))throw ct.thrown("Argument ["+i+"] requires a parameter");this.argsOptions[u[0]]=o}else this.argsOptions[u[0]]=!0}null!=this.argsOptions.o&&(this.argsOutput=this.argsOptions.o);for(var a,l=0,h=this.argsInput;l<h.length;){var c=h[l];if(++l,0<=c.indexOf("*")){if(1<this.argsInput.length)throw ct.thrown("Multiple Inputs with wildcards are not supported");if(this.argsInput=I.getFileListFromWildcard(c),0==this.argsInput.length)throw ct.thrown("Wildcard `"+c+"` returned 0 files");break}}if(null==this.argsAction&&0<this.argsInput.length&&(null!=(a=this.getArgAction(null,w.substr(kt.extname(this.argsInput[0].toLowerCase()),1,null)))&&(this.argsAction=a[0])),0==this.argsInput.length&&0<=["yes","multi"].indexOf(e.inputRule))throw ct.thrown("Input is required");if(null==this.argsOutput&&"yes"==e.outputRule)throw ct.thrown("Output is required");if(e.requireAction&&null==this.argsAction)throw ct.thrown("Setting an action is required");for(l=0,h=this.ARGS.Options;l<h.length;){var u=h[l];++l,null==u[2]&&(Object.prototype.hasOwnProperty.call(this.argsOptions,u[0])||(this.argsOptions[u[0]]=!1))}},onStart:function(){},onExit:function(t){D.end();this.T;process.stdout.write("[0m"),this.T.cursorShow()},printHelp:function(){function r(t){return x.rep(t," ")}function t(t){return"opt"==t?"is optional.":"is required."}function e(t,e){var i,s,n=(x.isEmpty(t)?"...":(i=new RegExp("(\n)","g".split("u").join("")),s="\n "+r(o.HELP_MARGIN),t.replace(i,s))).split("\n");return n[0]+=e,n.join("\n")}var o=this,i=this.ARGS,s=this.PROGRAM_INFO;this.T.ptag("<green> Program Usage:\n");var n="   "+s.executable+" ";0<i.Actions.length&&(n+="<action> "),1<i.Options.length&&(n+="[<options>...] "),"no"!=i.inputRule&&(n+="multi"==i.inputRule?"[<inputs>...] ":"<input> "),"no"!=i.outputRule&&(n+=this._sb[0]+"o <output> ");var a=this.T.ptag("<bold,white>"+n+"<!>\n").fg(E.darkgray),l=x.rep(40,"─");process.stdout.write(l+"\n");var h,c=!1;"no"!=i.inputRule&&(c=!0,this.T.ptag("<yellow> [input] <!>"),a=this.T,l=t(i.inputRule),process.stdout.write(l),"multi"==i.inputRule&&this.T.ptag("<darkgray> (multiple supported)"),a=this.T,process.stdout.write("\n"),null!=i.helpInput&&(h=new RegExp("(\n)","g".split("u").join("")),i.helpInput="<gray>\t "+i.helpInput.replace(h,"\n\t "),a=this.T.ptag(i.helpInput),process.stdout.write("\n"))),"no"!=i.outputRule&&(c=!0,this.T.ptag("<yellow> [output] <!>"),a=this.T,l=t(i.outputRule),process.stdout.write(l),process.stdout.write("\n"),null!=i.helpOutput&&(h=new RegExp("(\n)","g".split("u").join("")),i.helpOutput="<gray>\t "+i.helpOutput.replace(h,"\n\t "),a=this.T.ptag(i.helpOutput),process.stdout.write("\n"))),c&&(a=this.T.ptag(" <darkgray>"+x.rep(40,"─")),process.stdout.write("\n"));a=this.T;if(process.stdout.write("[0m"),0<i.Actions.length){this.T.ptag("<magenta> [actions] "),this.T.ptag("<darkmagenta>(you can set one action at a time)<!>\n");for(var u=0,_=i.Actions;u<_.length;){var d=_[u];++u,"-"!=d[1].charAt(0)&&(d[1]=e(d[1],null==d[2]?"":"<darkgray> | auto ext:["+d[2]+"] <!>"),this.T.fg(E.white).bold(),a=this.T.ptag(" "+d[0]+r(this.HELP_MARGIN-d[0].length)),process.stdout.write("[0m"),a.ptag(d[1]),this.T,process.stdout.write("\n"))}}if(1<i.Options.length){this.T.ptag("<cyan> [options] "),this.T.ptag("<darkcyan>(you can set multiple options)<!>\n");for(u=0,_=i.Options;u<_.length;){d=_[u];++u,"-"!=d[1].charAt(0)&&(d[1]=e(d[1],null==d[2]?"":"<darkgray> (requires parameter) <!>"),this.T.fg(E.white).bold(),a=this.T.ptag(" "+this._sb[0]+d[0]+r(this.HELP_MARGIN-d[0].length-1)),process.stdout.write("[0m"),a.ptag(d[1]),this.T,process.stdout.write("\n"))}}null!=this.ARGS.helpText&&(a=this.T,process.stdout.write("\n"),this.T.ptag(this.ARGS.helpText+"\n"))},printBanner:function(t){null==t&&(t=!1);var e=this.PROGRAM_INFO;this.T;process.stdout.write("\n"),this.T.ptag("<:cyan,black>==<!><cyan,bold> "+e.name+" <darkgray>v"+e.version+"<!>"),t?(null!=e.author&&this.T.ptag(" by "+e.author),this.T,process.stdout.write("\n"),null!=e.info&&this.T.ptag(" - "+e.info+"\n"),null!=e.desc&&this.T.ptag(" - "+e.desc+"\n")):(this.T,process.stdout.write("\n")),this.T.ptag("<"+v.string(E.darkgray)+">"+x.rep(40,"─")+"<!>\n")},getArgOption:function(t){for(var e=0,i=this.ARGS.Options;e<i.length;){var s=i[e];if(++e,s[0]==t)return s}return null},getArgAction:function(t,e){for(var i=0,s=this.ARGS.Actions;i<s.length;){var n=s[i];if(++i,null!=t&&n[0]==t)return n;if(null!=e&&null!=n[2]&&0<=n[2].split(",").indexOf(e.toLowerCase()))return n}return null},exitError:function(t,e){null==e&&(e=!1),this.T.ptag("\n<:darkred,white> ERROR <!> "+t+"<!>\n"),e&&this.T.ptag("<darkgray>"+x.rep(40,"─")+"\n<yellow> "+this._sb[0]+this._sb[1]+" <!> for usage info\n"),D.FLAG_STDOUT=!1,D.log(t,4),process.exit(1)},isAdmin:function(){return null!=F.quickExecS("fsutil dirty query %systemdrive% >nul")},autoCallAction:function(){var t=_.field(this,"action_"+this.argsAction);return null!=t&&_.isFunction(t)?t.apply(this,[]):null},waitKeyQuit:function(){this.T.ptag("\n<darkgray>Press any key to quit.<!>\n"),k.startCapture(!0,function(t){process.exit(0)})},getAppPathJoin:function(t){return kt.join(__dirname,t)},__class__:r,__properties__:{set_FLAG_USE_SLASH_FOR_OPTION:"set_FLAG_USE_SLASH_FOR_OPTION"}};function o(){this.btnStates=[],r.call(this)}o.__name__="Main",o.main=function(){new o},o.__super__=r,o.prototype=i(r.prototype,{init:function(){this.PROGRAM_INFO={name:u.NAME,version:u.VER,author:"JohnDimi"},this.ARGS.Actions=[["cfg","Opens the config file with the associated OS editor"],["install","-Called by the NPM installer to create the config file"]],this.ARGS.Options=[["size",'Set rendering area size. "WIDTH,HEIGHT" or "full" to use the full window area\ne.g. -size 80,20 | -size full',"1"]],this.set_FLAG_USE_SLASH_FOR_OPTION(!1),r.prototype.init.call(this)},onExit:function(t){0==t&&P._isInited&&this.T.move(0,P.height+1),r.prototype.onExit.call(this,t)},onStart:function(){var e=this;if("install"!=this.argsAction)if("cfg"!=this.argsAction){if(this.engine=new u,!this.engine.init()){this.printBanner(),this.T.ptag("\n <red>INIT ERROR : <!>"+this.engine.ERROR),this.T.ptag("\n <yellow>Settings file : <!>"+u.getConfigFullpath()),this.T.ptag("\n You can also run <yellow>psxmed cfg<!> to open the config file");this.T;return process.stdout.write("\n"),void this.waitKeyQuit()}if(0==this.engine.ar_games.length)return this.printBanner(),this.T.ptag(' - No games found in <yellow>"'+this.engine.cfg.path_iso+'"<!>\n'),void this.waitKeyQuit();this.parseSetSize(this.engine.cfg.terminal_size),null!=this.argsOptions.size&&("full"==this.argsOptions.size?(o.WIDTH=this.T.getWidth(),o.HEIGHT=this.T.getHeight()):this.parseSetSize(this.argsOptions.size)),this.T.setTitle(u.NAME),this.T.resizeTerminal(o.WIDTH,o.HEIGHT),this.T.pageDown(),this.T.clearScreen(),this.T.cursorHide(),P.create(new z,new X,o.WIDTH,o.HEIGHT,"black.1","blue.1");var t=new lt("wOpt",50,20);t.flag_enter_goto_next=!0,t.flag_close_on_esc=!0,t.focus_lock=!0,t.setAlign("fixed",2,25),t.addStack(new V("Launcher Options Games").setColor(null,"yellow")),t.addSeparator();var i=function(t){return"slOpt,"+t+","+e.engine.SETTING.h[t].split("-")[2]};t.addQ("Fullscreen","toggle,fs"),t.addQ("Blur","toggle,blur"),t.addQ("Bilinear Filter",i("bilinear")),t.addQ("Stretch",i("stretch")),t.addQ("Shader",i("shader")),t.addQ("Special",i("special")),t.addSeparator(),t.addStack(new V("Valid when (stretch=0) :").setColor(null,"yellow")),t.addQ("Widen","slNum,widen,0,1,0.1,0"),t.addQ("Window Scale","slNum,wsc,1,5,0.25,2"),t.addQ("FullScreen Scale","slNum,fsc,1,5,0.25,2"),t.addStackInline([new Q("cancel","Cancel",1),new Q("ok","Save",1).colorFocus("black","green")],-1,4,"c"),t.events.onAny=Dt(this,this.wOpt_events),P.A.screen(t),this.wList=new B("wList",o.WIDTH-33,o.HEIGHT-7),this.wList.pos(3,3),this.wList.addStack(new V("Available Games").setColor(null,"green")),this.wList.addSeparator();var s=new nt(null,this.wList.get_inWidth(),this.wList.get_inHeight()-2);s.flag_letter_jump=!0,s.setData(this.engine.getGameNames()),s.onSelect=function(t){t.flag_ghost_active=!0,e.wGam_open(t.index),t.flag_ghost_active=!1},this.wList.addStack(s),this.wList.events.onOpen=function(){xt.__cast(P.DB.h.foot,rt).setData("Nav:↑↓←→|Select:Enter|Focus:Tab|Back:Esc|Quit:^c")},this.wGam=new B("wGam",20,5,R.win.h["red.1"]),this.wGam.setPopupBehavior(),this.wGam.posNext(this.wList,2).move(0,2),this.wGam.addStack(new Q("launch","Launch")),this.wGam.addSeparator(),this.engine.flag_use_altsave&&(this.wGam.size(this.wGam.width,this.wGam.height+4),this.btnStates.push(this.wGam.addStack(new Q("pull","Pull Saves"))),this.btnStates.push(this.wGam.addStack(new Q("push","Push Saves"))),this.btnStates.push(this.wGam.addStack(new Q("del>","Delete >"))),this.wGam.addSeparator()),this.wGam.addStack(new Q("","Close").extra("close")),this.wGam.events.onAny=Dt(this,this.wGam_events),this.wTag=new B("wTag",this.wGam.width+2,4),this.wTag.set_borderStyle(0),this.wTag.addStackInline([new V("Extension:"),(new V).setColor(null,"darkgray")]),this.wTag.addStackInline([new V("Ready Saves:"),(new V).setColor(null,"yellow")]),this.wTag.addStackInline([new V("Mednafen Saves:"),(new V).setColor(null,"cyan")]),this.wTag.addStack(new V("(Saves Total : States)").setColor(null,"darkgray")),this.engine.flag_use_altsave&&P.A.down(this.wTag,this.wGam,0,1),this.wLog=new B("wLog",o.WIDTH-6,1),this.wLog.focusable=!1,this.wLog.modStyle({text:"yellow",borderStyle:0}),this.wLog.addStack(new V("",this.wLog.get_inWidth(),"center").setSID("log")),this.wLog.pos(3,o.HEIGHT-3),this.winCreate_HeaderFooter(),P.STATE.create("main",[this.wList]),P.STATE.create("opt",[t]),P.STATE.goto("main"),this.engine.onMednafenExit=Dt(this,this.onMednafenExit)}else{this.T.ptag("Opening configuration file...");var n="start "+u.getConfigFullpath();yt.spawnSync(n,{shell:!0,stdio:"inherit"})}else u.NPM_install()?(this.T,process.stdout.write("- Created empty config file OK")):(this.T,process.stdout.write("- Config file already exists from previous installation. Leaving as is."))},onMednafenExit:function(){var t,e=P.DB.h.nowplay;null!=e&&(t=P.DB,Object.prototype.hasOwnProperty.call(t.h,"nowplay")&&delete t.h.nowplay,e.close()),this.wBar.open(),P.DB.h.foot.open(),this.wList.open(!0)},wGam_openDel:function(){var s=this,n=new B(null,this.wGam.width,this.wGam.height,this.wGam.style);n.pos(this.wGam.x,this.wGam.y),n.focus_lock=!0,n.setPopupBehavior(),n.addStack(new V("DELETE :").setColor(null,"red","black")),n.addSeparator(),n.addStack(new Q("0","States in CUSTOM").confirm("Del States in CUSTOM")),n.addStack(new Q("1","States in MED").confirm("Del States in MED")),n.addStack(new Q("2","Everything").confirm("Delete all Saves")),n.addSeparator(),n.addStack(new Q("back","Back")),n.events.onClose=Dt(t=this.wGam,t.focus),n.events.onElem=function(t,e){if("fire"==t){var i=!0;switch(e.SID){case"0":s.engine.deleteSave("states_sec");break;case"1":s.engine.deleteSave("states_med");break;case"2":s.engine.deleteSave("all");break;default:i=!1}n.close(),i&&s.wGam_open(s.engine.index,!0)}},xt.__cast(n.getEl("0"),Q).set_disabled(0==this.engine.saves_ram_states.length),xt.__cast(n.getEl("1"),Q).set_disabled(0==this.engine.saves_med_states.length),n.open(!0)},wGam_open:function(t,e){null==e&&(e=!1),this.engine.prepareGame(t),this.engine.flag_use_altsave&&(this.btnStates[0].set_disabled(!this.engine.anySavesLOCAL()),this.btnStates[1].set_disabled(!this.engine.anySavesRAM()),this.btnStates[2].set_disabled(this.btnStates[0].disabled&&this.btnStates[1].disabled)),P.DB.h.wGam.open(!0),e&&null!=this.engine.OPLOG&&this.logStatus(this.engine.OPLOG)},wGam_events:function(t,e){if("close"==t)this.wList.focus(),this.wTag.close();else if("open"==t)this.engine.flag_use_altsave&&(this.wTag.open(),xt.__cast(this.wTag.getElIndex(2),V).set_text("["+this.engine.current.ext+"]"),xt.__cast(this.wTag.getElIndex(4),V).set_text("("+this.engine.saves_ram.length+":"+this.engine.saves_ram_states.length+")"),xt.__cast(this.wTag.getElIndex(6),V).set_text("("+this.engine.saves_med.length+":"+this.engine.saves_med_states.length+")"));else if("fire"==t)switch(e.SID){case"del>":this.wGam_openDel();break;case"launch":if(P.DB.h.foot.close(),this.wGam.close(),this.wList.close(),this.wLog.close(),this.wTag.close(),!this.engine.launchGame())return this.logStatus(this.engine.ERROR),void this.onMednafenExit();var i=at.create("Now Playing:\n"+this.engine.current.name,-1,null,40,R.win.h["gray.1"]);(P.DB.h.nowplay=i).open(!0);break;case"pull":this.engine.copySave_Pull(),this.wGam_open(this.engine.index,!0);break;case"push":this.engine.copySave_Push(),this.wGam_open(this.engine.index,!0)}},wOpt_events:function(t,e){if("close"==t&&e.type==j.window)P.STATE.goto("main");else if("open"==t&&e.type==j.window){xt.__cast(P.DB.h.foot,rt).setData("Nav:↑↓|Select:Enter|Change:←→|Focus:Tab|Back:Esc|Quit:^c");for(var i=P.DB.h.wOpt,s=mt.keysIterator(this.engine.SETTING.h);s.hasNext();){var n=s.next();i.getEl(n).type==j.toggle?i.getEl(n).setData("1"==this.engine.setting_get(n)):i.getEl(n).setData(this.engine.setting_get(n))}}else if("fire"==t)switch(e.SID){case"cancel":P.DB.h.wOpt.close();break;case"ok":for(i=P.DB.h.wOpt,s=mt.keysIterator(this.engine.SETTING.h);s.hasNext();){var r,n=s.next(),o=i.getEl(n),a="";o.type==j.option?a=xt.__cast(o,tt).getSelected():o.type==j.toggle?a=xt.__cast(o,st).getData()?"1":"0":o.type==j.number&&(a=""+(null==(r=xt.__cast(o,$).getData())?"null":v.string(r))),this.engine.setting_set(n,a)}this.engine.setting_process(),this.engine.settings_save()?this.logStatus("Settings Saved [OK]"):this.logStatus("Could not write settings to file"),i.close()}},winCreate_HeaderFooter:function(){var e=this;this.wBar=new ot("wBar",1,1,{bs:0,colbg:"darkcyan",colfg:"darkblue",bSmb:[1,0,0]}),this.wBar.tab_mode=1,this.wBar.setItems(["Options","About","Quit"]),P.A.screen(this.wBar,"r","t",0),this.wBar.onSelect=function(t){switch(t){case 0:P.STATE.goto("opt");break;case 1:e.wBar.openSub(at.create("Mednafen launcher\nby John Dimi 2020",0,null,40),!0);break;case 2:process.exit(0)}};var t=new B(null,o.WIDTH-this.wBar.width,1);t.focusable=!1,t.modStyle({bg:"darkcyan",text:"black",borderStyle:0,borderColor:{fg:"darkblue"}}),t.padding(2,0),t.addStack(new V(this.PROGRAM_INFO.name+" v"+this.PROGRAM_INFO.version));var i=new rt;i.pos(0,o.HEIGHT-1),P.DB.h.foot=i,P.add(t),P.add(i),P.add(this.wBar)},logStatus:function(t){var e=this,i=this.wLog.getElIndex(1);i.set_text(t),this.wLog.open(),i.blink(5,180),null!=this.logTimer&&(this.logTimer.stop(),this.logTimer=null),this.logTimer=ut.delay(function(){e.wLog.close()},o.STATUS_POPUP_TIME)},parseSetSize:function(t){var e=xt.__cast(t,String).split(",");if(null==e||2!=e.length)throw ct.thrown("Cannot read Size from "+t);o.WIDTH=Math.max(v.parseInt(e[0]),o.WIDTH_MIN),o.HEIGHT=Math.max(v.parseInt(e[1]),o.HEIGHT_MIN)},__class__:o}),Math.__name__="Math";var _=function(){};_.__name__="Reflect",_.field=function(t,e){try{return t[e]}catch(t){return null}},_.getProperty=function(t,e){var i;if(null==t)return null;var s=!!t.__properties__&&(i=t.__properties__["get_"+e]);return s?t[i]():t[e]},_.fields=function(t){var e=[];if(null!=t){var i,s=Object.prototype.hasOwnProperty;for(i in t)"__id__"!=i&&"hx__closures__"!=i&&s.call(t,i)&&e.push(i)}return e},_.isFunction=function(t){return"function"==typeof t&&!(t.__name__||t.__ename__)},_.compare=function(t,e){return t==e?0:e<t?1:-1},_.isObject=function(t){if(null==t)return!1;var e=typeof t;return"string"==e||"object"==e&&null==t.__enum__||"function"==e&&null!=(t.__name__||t.__ename__)},_.isEnumValue=function(t){return null!=t&&null!=t.__enum__},_.deleteField=function(t,e){return!!Object.prototype.hasOwnProperty.call(t,e)&&(delete t[e],!0)},_.copy=function(t){if(null==t)return null;for(var e={},i=0,s=_.fields(t);i<s.length;){var n=s[i];++i,e[n]=_.field(t,n)}return e};var v=function(){};v.__name__="Std",v.string=function(t){return xt.__string_rec(t,"")},v.parseInt=function(t){if(null!=t)for(var e=0,i=t.length;e<i;){var s=e++,n=t.charCodeAt(s);if(n<=8||14<=n&&32!=n&&45!=n){var r=t.charCodeAt(1+s),o=parseInt(t,120==r||88==r?16:10);return isNaN(o)?null:o}}return null};function d(){}d.__name__="StringTools",d.isSpace=function(t,e){var i=w.cca(t,e);return 8<i&&i<14||32==i},d.ltrim=function(t){for(var e=t.length,i=0;i<e&&d.isSpace(t,i);)++i;return 0<i?w.substr(t,i,e-i):t},d.rtrim=function(t){for(var e=t.length,i=0;i<e&&d.isSpace(t,e-i-1);)++i;return 0<i?w.substr(t,0,e-i):t},d.trim=function(t){return d.ltrim(d.rtrim(t))},d.lpad=function(t,e,i){if(e.length<=0)return t;var s="";for(i-=t.length;s.length<i;)s+=null==e?"null":""+e;return s+=null==t?"null":""+t},d.rpad=function(t,e,i){if(e.length<=0)return t;var s="";for(s+=null==t?"null":""+t;s.length<i;)s+=null==e?"null":""+e;return s};function n(){}n.__name__="haxe.io.Output";function a(t){this.fd=t}a.__name__="_Sys.FileOutput",a.__super__=n,a.prototype=i(n.prototype,{writeByte:function(t){St.writeSync(this.fd,String.fromCodePoint(t))},writeBytes:function(t,e,i){var s=t.b;return St.writeSync(this.fd,Et.from(s.buffer,s.byteOffset,t.length),e,i)},writeString:function(t,e){St.writeSync(this.fd,t)},flush:function(){St.fsyncSync(this.fd)},close:function(){St.closeSync(this.fd)},__class__:a});function l(){}l.__name__="haxe.io.Input";function h(t){this.fd=t}h.__name__="_Sys.FileInput",h.__super__=l,h.prototype=i(l.prototype,{readByte:function(){var t=Et.alloc(1);try{St.readSync(this.fd,t,0,1,null)}catch(t){var e=ct.caught(t).unwrap();throw"EOF"==e.code?ct.thrown(new wt):ct.thrown(vt.Custom(e))}return t[0]},readBytes:function(t,e,i){var s=t.b,n=Et.from(s.buffer,s.byteOffset,t.length);try{return St.readSync(this.fd,n,e,i,null)}catch(t){var r=ct.caught(t).unwrap();throw"EOF"==r.code?ct.thrown(new wt):ct.thrown(vt.Custom(r))}},close:function(){St.closeSync(this.fd)},__class__:h});function p(){}p.__name__="Type",p.createEnum=function(t,e,i){var s=_.field(t,e);if(null==s)throw ct.thrown("No such constructor "+e);if(_.isFunction(s)){if(null==i)throw ct.thrown("Constructor "+e+" need parameters");return s.apply(t,i)}if(null!=i&&0!=i.length)throw ct.thrown("Constructor "+e+" does not need parameters");return s},p.enumParameters=function(t){var e=f[t.__enum__],i=e[e.__constructs__[t._hx_index]].__params__;if(null==i)return[];for(var s=[],n=0;n<i.length;){var r=i[n];++n,s.push(t[r])}return s};function g(){}g.__name__="djA.DataT",g.copyFields=function(t,e){if(null==t)return e;if(null==e)e=_.copy(t);else for(var i=0,s=_.fields(t);i<s.length;){var n=s[i];++i,_.isObject(_.field(t,n))&&null==xt.getClass(_.field(t,n))?e[n]=g.copyFields(_.field(t,n),_.field(e,n)):e[n]=_.field(t,n)}return e},g.copyDeep=function(t){for(var e={},i=0,s=_.fields(t);i<s.length;){var n=s[i];++i,_.isObject(_.field(t,n))&&null==xt.getClass(_.field(t,n))?e[n]=g.copyDeep(_.field(t,n)):e[n]=_.field(t,n)}return e};function m(){}m.__name__="djA.MathT",m.roundFloat=function(t,e){return null==e&&(e=2),t*=Math.pow(10,e),Math.round(t)/Math.pow(10,e)};var x=function(){};x.__name__="djA.StrT",x.isEmpty=function(t){return null==t||0==t.length},x.rep=function(t,e){return d.lpad("",e,t)},x.padString=function(t,e,i,s){null==s&&(s=" "),null==i&&(i="l");var n=e-t.length;if(0==n)return t;if(n<0)return t.substring(0,e-1)+x.OVERFLOW_SMBL;switch(i){case"c":var r=Math.ceil(n/2),o=Math.floor(n/2);t=d.rpad("",s,r)+t+d.rpad("",s,o);break;case"r":t=d.lpad(t,s,e);break;default:t=d.rpad(t,s,e)}return t},x.splitToLines=function(t,e){var i=new RegExp("(\n)","g".split("u").join(""));t=t.replace(i," #nl# ");for(var s,i=new RegExp("(\\s|\t)","g".split("u").join("")),n=(t=t.replace(i," ")).split(" "),r=[],o=0,a=n.length,l=0,h="",c=function(t){r.push(t),l=0,h=""};;){if("#nl#"==n[o]){if(c(h),++o<a)continue;break}if((s=n[o].length)+l<e?(h+=n[o]+" ",l+=s+1):e<s+l?0<l?(r.push(h),h=n[o]+" ",l=s+1):c(h=n[o].substring(0,e-1)+x.OVERFLOW_SMBL):c(h+n[o]),!(++o<a))break}return 0<l&&c(h),r};var y=function(t){this.workingFile=t,this.data={},this.comments=new mt};y.__name__="djA.cfg.ConfigFileA",y.prototype={save:function(t){if(null!=t&&(this.workingFile=t),null==this.workingFile)return this.err("No file set");this.renderedText=[],this.renderNode(this.data);try{St.writeFileSync(this.workingFile,this.renderedText.join("\n"))}catch(t){return this.err('Cannot save "'+this.workingFile+'" Does the folder exist? Do you have write access?')}return!0},load:function(t){if(null!=t&&(this.workingFile=t),null==this.workingFile)return this.err("No file set");if(!At.exists(this.workingFile))return this.err('File "'+this.workingFile+'" does not exist');for(var e=St.readFileSync(this.workingFile,{encoding:"utf8"}).split("\n"),i=0,s=[],n=0;n<e.length;){var r=e[n];if(++n,++i,!((r=d.trim(r)).length<1)){var o=r.charAt(0);if("#"!=o&&";"!=o){var a=r.split(" "),l=a[0].split(".");a.shift();var h="";0<a.length&&(h=a.join(" "));try{this.setFieldFromAr(l,h)}catch(t){var c=ct.caught(t).unwrap();return this.err("Parse Error, File:"+this.workingFile+" Line:"+i+", "+v.string(c))}var u=this.comments,_=l.join(".");u.h[_]=s,s=[]}else s.push(r)}}return!0},getDocument:function(){return this.renderedText=[],this.renderNode(this.data),this.renderedText},set:function(t,e){this.setFieldFromAr(t.split("."),e,!0)},delete:function(t){for(var e=t.split("."),i=this.data,s=e[0];1<e.length;)if(s=e.shift(),null==(i=_.field(i,s)))return!1;return _.deleteField(i,s)},exists:function(t){for(var e=t.split("."),i=0,s=this.data;i<e.length;){if(!Object.prototype.hasOwnProperty.call(s,e[i]))return!1;s=_.field(s,e[i]),++i}return!0},get:function(t){for(var e=t.split("."),i=0,s=this.data;i<e.length;){if(!Object.prototype.hasOwnProperty.call(s,e[i]))return null;s=_.field(s,e[i]),++i}return s},clear:function(){this.data={},this.comments=new mt},setFieldFromAr:function(t,e,i){null==i&&(i=!1);for(var s=this.data,n=0;n<t.length-1;){var r=_.field(s,t[n]);null==r?s[t[n]]={}:"string"==typeof r&&(s["_"+t[n]]=r,s[t[n]]={}),s=_.field(s,t[n]),++n}i||null==_.field(s,t[n])?s[t[n]]=e:s["_"+t[n]]=e},renderNode:function(t,e){null==e&&(e="");for(var i=_.fields(t),s=0;s<i.length;){var n=_.field(t,i[s]),r=0==e.length?"":".";if("string"==typeof n){"_"==i[s].charAt(0)&&(i[s]=w.substr(i[s],1,null));var o=e+r+i[s],a=this.comments.h[o];if(null!=a)for(var l=0;l<a.length;){var h=a[l];++l,this.renderedText.push(h)}this.renderedText.push(o+" "+v.string(n))}else this.renderNode(n,e+r+i[s]);++s}},err:function(t){return this.ERROR=t,!1},__class__:y};var b=function(t){this.data=new mt,null!=t&&this.parse(t)};b.__name__="djA.cfg.ConfigFileB",b.prototype={parse:function(t){for(var e=this,i=null,s=null,n=null,r=!1,o=function(){var t;Object.prototype.hasOwnProperty.call(e.data.h,i)?t=e.data.h[i]:(t=new mt,e.data.h[i]=t),t.h[s]=n},a=0,l=t.split("\n");a<l.length;){var h=l[a];++a;var c=d.trim(h);if(0!=c.length){if(!(0<=b.COMMENTS.indexOf(c.charAt(0))))if(b.reg_section.match(c)){if(null!=i&&null!=s){if(null==n)throw ct.thrown('Key "'+s+'" does not have a value defined');o()}i=b.reg_section.matched(1),s=n=null,r=!1}else if(b.reg_def.match(c)){if(null==i)throw ct.thrown("Parse Error, Variable needs to be in a [section]");if(null!=s){if(null==n)throw ct.thrown('Parse Error: Key "'+s+'" does not have a value defined');o()}s=b.reg_def.matched(1),n=b.reg_def.matched(2),s=d.rtrim(s),r=!1,"\\l"==(n=d.ltrim(n))&&(r=!0,n="")}else{if(null==s)throw ct.thrown("Parse Error: Value defined outside of a key ("+h+")");r=!0,null!=n&&0!=n.length?"\\e"!=c?n.charAt(n.length-1)==b.NO_NEW_LINE?(n=w.substr(n,0,-1),n+=c):n=n+"\n"+d.rtrim(h):r=!1:n=d.rtrim(h)}}else r&&(n+="\n")}if(null!=s){if(null==n)throw ct.thrown('Parse Error: Key "'+s+'" does not have a value defined');o()}},exists:function(t,e){return!!Object.prototype.hasOwnProperty.call(this.data.h,t)&&Object.prototype.hasOwnProperty.call(this.data.h[t].h,e)},get:function(t,e){var i=this.data.h[t];return null!=i?i.h[e]:null},getTextArray:function(t,e){if(!this.exists(t,e))return null;for(var i=this.get(t,e).split("\n"),s=[],n=0;n<i.length;){var r=i[n];++n;var o=d.trim(r);0!=o.length&&s.push(o)}return s},getObj:function(t,e){null==e&&(e={});for(var i=this.data.h[t],s=mt.kvIterator(i.h);s.hasNext();){var n=s.next(),r=n.key,o=n.value;e[r]=o}return e},getObjEx:function(t,e){null==e&&(e={});for(var i=this.data.h[t],s=mt.kvIterator(i.h);s.hasNext();){var n,r,o=s.next(),a=o.key,l=o.value;"#"==l.charAt(0)?(n=w.substr(l,1,null),r=parseFloat(n),e[a]=r%1!=0?r:0|r):e[a]="true"==l||"false"!=l&&l}return e},__class__:b};function S(){}var T=f["djNode.KeycodeID"]={__ename__:!0,__constructs__:["up","down","left","right","home","insert","delete","end","pageup","pagedown","backsp","tab","enter","space","esc","ctrlC","acute","F1","F2","F3","F4","F5","F6","F7","F8","F9","F10","F11","F12","other"],up:{_hx_index:0,__enum__:"djNode.KeycodeID",toString:e},down:{_hx_index:1,__enum__:"djNode.KeycodeID",toString:e},left:{_hx_index:2,__enum__:"djNode.KeycodeID",toString:e},right:{_hx_index:3,__enum__:"djNode.KeycodeID",toString:e},home:{_hx_index:4,__enum__:"djNode.KeycodeID",toString:e},insert:{_hx_index:5,__enum__:"djNode.KeycodeID",toString:e},delete:{_hx_index:6,__enum__:"djNode.KeycodeID",toString:e},end:{_hx_index:7,__enum__:"djNode.KeycodeID",toString:e},pageup:{_hx_index:8,__enum__:"djNode.KeycodeID",toString:e},pagedown:{_hx_index:9,__enum__:"djNode.KeycodeID",toString:e},backsp:{_hx_index:10,__enum__:"djNode.KeycodeID",toString:e},tab:{_hx_index:11,__enum__:"djNode.KeycodeID",toString:e},enter:{_hx_index:12,__enum__:"djNode.KeycodeID",toString:e},space:{_hx_index:13,__enum__:"djNode.KeycodeID",toString:e},esc:{_hx_index:14,__enum__:"djNode.KeycodeID",toString:e},ctrlC:{_hx_index:15,__enum__:"djNode.KeycodeID",toString:e},acute:{_hx_index:16,__enum__:"djNode.KeycodeID",toString:e},F1:{_hx_index:17,__enum__:"djNode.KeycodeID",toString:e},F2:{_hx_index:18,__enum__:"djNode.KeycodeID",toString:e},F3:{_hx_index:19,__enum__:"djNode.KeycodeID",toString:e},F4:{_hx_index:20,__enum__:"djNode.KeycodeID",toString:e},F5:{_hx_index:21,__enum__:"djNode.KeycodeID",toString:e},F6:{_hx_index:22,__enum__:"djNode.KeycodeID",toString:e},F7:{_hx_index:23,__enum__:"djNode.KeycodeID",toString:e},F8:{_hx_index:24,__enum__:"djNode.KeycodeID",toString:e},F9:{_hx_index:25,__enum__:"djNode.KeycodeID",toString:e},F10:{_hx_index:26,__enum__:"djNode.KeycodeID",toString:e},F11:{_hx_index:27,__enum__:"djNode.KeycodeID",toString:e},F12:{_hx_index:28,__enum__:"djNode.KeycodeID",toString:e},other:{_hx_index:29,__enum__:"djNode.KeycodeID",toString:e}};S.__name__="djNode.Keycode",S.toKeyCodeID=function(t){if(null==w.cca(t,1))switch(w.cca(t,0)){case 3:return T.ctrlC;case 8:return T.backsp;case 9:return T.tab;case 13:return T.enter;case 27:return T.esc;case 32:return T.space;case 96:return T.acute;case 127:return T.backsp}else if(27==w.cca(t,0)&&91==w.cca(t,1))switch(w.cca(t,2)){case 49:switch(w.cca(t,3)){case 55:return T.F6;case 56:return T.F7;case 57:return T.F8;case 126:return T.home}break;case 50:switch(w.cca(t,3)){case 48:return T.F9;case 49:return T.F10;case 51:return T.F11;case 52:return T.F12;case 126:return T.insert}break;case 51:return T.delete;case 52:return T.end;case 53:return T.pageup;case 54:return T.pagedown;case 65:return T.up;case 66:return T.down;case 67:return T.right;case 68:return T.left;case 91:switch(w.cca(t,3)){case 65:return T.F1;case 66:return T.F2;case 67:return T.F3;case 68:return T.F4;case 69:return T.F5}}return null};var k=function(){};k.__name__="djNode.Keyboard",k.startCapture=function(t,e){null==t&&(t=!0),k.stop(),null!=e&&(k.onData=e),k.stdin=process.stdin,k.stdin.setRawMode(t),k.stdin.setEncoding("utf8"),k.stdin.on("data",k.onKeyData),k.stdin.resume()},k.onKeyData=function(t){if(k.FLAG_CAN_BREAK&&t==S.CTRLC)return k.stop(),null!=k.onBreak&&k.onBreak(),void(k.onBreak=null);null!=k.onData&&k.onData(t)},k.stop=function(){null!=k.stdin&&(k.stdin.pause(),k.stdin.setRawMode(!1),k.stdin.removeAllListeners("data"))},k.flush=function(){null!=k.stdin&&(k.stdin.pause(),k.stdin.resume())},k.readOnceSync=function(){var t=Et.alloc(512),e=0,e=0;try{e=St.readSync(process.stdin.fd,t,0,512,null)}catch(t){var i=ct.caught(t).unwrap();throw ct.thrown(i)}return t.toString("utf8",0,e-2)};var E=f["djNode.TColor"]={__ename__:!0,__constructs__:["black","white","gray","red","green","blue","yellow","cyan","magenta","darkgray","darkred","darkgreen","darkblue","darkyellow","darkcyan","darkmagenta"],black:{_hx_index:0,__enum__:"djNode.TColor",toString:e},white:{_hx_index:1,__enum__:"djNode.TColor",toString:e},gray:{_hx_index:2,__enum__:"djNode.TColor",toString:e},red:{_hx_index:3,__enum__:"djNode.TColor",toString:e},green:{_hx_index:4,__enum__:"djNode.TColor",toString:e},blue:{_hx_index:5,__enum__:"djNode.TColor",toString:e},yellow:{_hx_index:6,__enum__:"djNode.TColor",toString:e},cyan:{_hx_index:7,__enum__:"djNode.TColor",toString:e},magenta:{_hx_index:8,__enum__:"djNode.TColor",toString:e},darkgray:{_hx_index:9,__enum__:"djNode.TColor",toString:e},darkred:{_hx_index:10,__enum__:"djNode.TColor",toString:e},darkgreen:{_hx_index:11,__enum__:"djNode.TColor",toString:e},darkblue:{_hx_index:12,__enum__:"djNode.TColor",toString:e},darkyellow:{_hx_index:13,__enum__:"djNode.TColor",toString:e},darkcyan:{_hx_index:14,__enum__:"djNode.TColor",toString:e},darkmagenta:{_hx_index:15,__enum__:"djNode.TColor",toString:e}},A=function(){this.PARSED_NOTAG="",this.ENABLE_NOTAG=!0;var t=new pt;t.set(E.darkgray,"[90m"),t.set(E.red,"[91m"),t.set(E.green,"[92m"),t.set(E.yellow,"[93m"),t.set(E.blue,"[94m"),t.set(E.magenta,"[95m"),t.set(E.cyan,"[96m"),t.set(E.white,"[97m"),t.set(E.black,"[30m"),t.set(E.darkred,"[31m"),t.set(E.darkgreen,"[32m"),t.set(E.darkyellow,"[33m"),t.set(E.darkblue,"[34m"),t.set(E.darkmagenta,"[35m"),t.set(E.darkcyan,"[36m"),t.set(E.gray,"[37m"),this.COLORS_FG=t,(t=new pt).set(E.darkgray,"[100m"),t.set(E.red,"[101m"),t.set(E.green,"[102m"),t.set(E.yellow,"[103m"),t.set(E.blue,"[104m"),t.set(E.magenta,"[105m"),t.set(E.cyan,"[106m"),t.set(E.white,"[107m"),t.set(E.black,"[40m"),t.set(E.darkred,"[41m"),t.set(E.darkgreen,"[42m"),t.set(E.darkyellow,"[43m"),t.set(E.darkblue,"[44m"),t.set(E.darkmagenta,"[45m"),t.set(E.darkcyan,"[46m"),t.set(E.gray,"[47m"),this.COLORS_BG=t};A.__name__="djNode.Terminal",A.prototype={resizeTerminal:function(t,e){var i="mode con: cols="+t+" lines="+e;yt.spawnSync(i,{shell:!0,stdio:"inherit"})},setTitle:function(t){var e="title "+t;yt.spawnSync(e,{shell:!0,stdio:"inherit"})},getWidth:function(){return process.stdout.columns},getHeight:function(){return process.stdout.rows},fg:function(t){if(null==t)return process.stdout.write("[39m"),this;var e=this.COLORS_FG.get(t);return process.stdout.write(e),this},bg:function(t){if(null==t)return process.stdout.write("[49m"),this;var e=this.COLORS_BG.get(t);return process.stdout.write(e),this},bold:function(){return process.stdout.write("[1m"),this},move:function(t,e){return process.stdout.cursorTo(t-1,e-1),this},moveR:function(t,e){return process.stdout.moveCursor(t,e),this},pageDown:function(t){null==t&&(t=0),0==t&&(t=this.getHeight());var e=d.lpad("","\n",t);return process.stdout.write(e),this.moveR(0,-t)},clearScreen:function(t){return null==t&&(t=2),0<t&&this.move(1,1),process.stdout.clearScreenDown(),this},cursorHide:function(){return process.stdout.write("[?25l"),this},cursorShow:function(){return process.stdout.write("[?25h"),this},ptag:function(t){var e=this.parseTags(t);return process.stdout.write(e),this},parseTags:function(t){var a=this,e=new c("<(\\S+?)>","g").map(t,function(e){for(var i=e.matched(1),t=i.split(","),s="",n=0;n<t.length;){var r,o=t[n];switch(++n,o){case"!":r="[0m";break;case"!bg":r="[49m";break;case"!blink":r="[25m";break;case"!bold":r="[21m";break;case"!dim":r="[22m";break;case"!fg":r="[39m";break;case"!underl":r="[24m";break;case"blink":r="[5m";break;case"bold":r="[1m";break;case"dim":r="[2m";break;case"underl":r="[4m";break;default:if(0==o.indexOf(":"))try{r=a.COLORS_BG.get(p.createEnum(E,o.split(":")[1],null))}catch(t){throw ct.thrown("Tag Error: Color does not exist in `"+i+"`")}else try{r=a.COLORS_FG.get(p.createEnum(E,o,null))}catch(t){r=e.matched(0)}}s+=r}return s});return this.ENABLE_NOTAG&&(this.PARSED_NOTAG=new c("<(\\S+?)>","g").map(t,function(t){return""})),e},__class__:A};var O=function(){};O.__name__="djNode.app.PismoMount",O.mount=function(t,e){if(null!=e){F.quickExecS(O.EXE+" mount -i -m "+e+' "'+t+'"');return e+":\\"}F.quickExecS(O.EXE+' mount -i "'+t+'"');var i=F.quickExecS(O.EXE+' list "'+t+'"'),s=new c(".*(?:\\.zip|\\.pfo|\\.cfs) (.*)","ig");return s.match(i)?s.matched(1):null},O.unmount=function(t){try{var e=null==t?"":'"'+t+'"';if(null!=F.quickExecS(O.EXE+" unmount "+e))return!0}catch(t){}return!1};var I=function(){};I.__name__="djNode.tools.FileTool",I.createRecursiveDir=function(e){var i=kt.normalize(e).split(kt.sep),t=i.length;if(t<=0)throw ct.thrown('Path "'+e+'" is invalid');var s=0,n="";if(0<i[0].indexOf(":")){try{St.statSync(i[0])}catch(t){throw ct.caught(t).unwrap()instanceof Error?ct.thrown('Drive "'+i[0]+'" does not exist!'):t}s=1,n=i[0]+kt.sep}try{for(;s<t;)n=kt.join(n,i[s]),0==I.pathExists(n)&&St.mkdirSync(n),++s}catch(t){throw ct.caught(t).unwrap()instanceof Error?ct.thrown('Cannot create "'+e+'"'):t}},I.pathExists=function(t){try{St.statSync(t)}catch(t){if(ct.caught(t).unwrap()instanceof Error)return!1;throw t}return!0},I.copyFileSync=function(t,e){St.writeFileSync(e,St.readFileSync(t))},I.getFileListFromDir=function(t,e){null==e&&(e=!1);for(var i=St.readdirSync(kt.normalize(t)),s=[],n=0;n<i.length;){var r=i[n];++n,St.statSync(kt.join(t,r)).isFile()&&(e?s.push(kt.join(t,r)):s.push(r))}return s},I.getFileListFromDirR=function(t,r){var o=[],a=null;return(a=function(t){for(var e=St.readdirSync(kt.normalize(t)),i=0;i<e.length;){var s=e[i];++i;var n=kt.join(t,s);try{St.statSync(n).isDirectory()?a(n):(null==r||-1<r.indexOf(I.getFileExt(s)))&&o.push(n)}catch(t){if(ct.caught(t).unwrap()instanceof Error)return;throw t}}})(t),o},I.getFileListFromWildcard=function(t){var e,i=[],s=kt.dirname(t),n=I.getFileExt(t),r=new c("(\\S*)\\.","");if(r.match(kt.basename(t))){if(1<(e=r.matched(1)).length&&0<e.indexOf("*"))throw ct.thrown("Advanced search is currently unsupported, use basic [*.*] or [*.ext]")}else e="*";for(var o,a=St.readdirSync(kt.normalize(s)),l=0;l<a.length;){var h=a[l];++l;try{o=St.statSync(kt.join(s,h))}catch(t){continue}if(o.isFile()){if("*"!=e){if(!r.match(h))continue;if(e!=r.matched(1))continue}if(".*"==n){i.push(kt.join(s,h));continue}if(n==kt.extname(h).toLowerCase()){i.push(kt.join(s,h));continue}}}return i},I.getFileMD5=function(t){var e=St.openSync(t,"r"),i=bt.createHash("md5"),s=Et.alloc(8192);try{for(var n;n=St.readSync(e,s,0,8192,null),i.update(s.slice(0,n)),8192==n;);}catch(t){if(ct.caught(t).unwrap()instanceof Error)return St.closeSync(e),null;throw t}return St.closeSync(e),i.digest("hex")},I.getFileExt=function(t){return kt.extname(t).toLowerCase()};var D=function(){};D.__name__="djNode.tools.LOG",D.init=function(){D._isInited||(D._isInited=!0,D.messages=[])},D.end=function(){D.flag_socket_log&&D.io.close()},D.log=function(t,e,i){var s,n;null==e&&(e=1),e<D.logLevel||(s={pos:null,log:v.string(t),level:e},0<D.BUFFER_SIZE&&D.messages.length>=D.BUFFER_SIZE&&D.messages.shift(),D.messages.push(s),D.flag_socket_log&&D.io.sockets.emit("logText",{data:s.log,pos:s.pos,level:s.level}),null!=D.logFile&&D.push_File(s),null!=D.onLog&&D.onLog(s),D.FLAG_STDOUT&&(r.TERMINAL,n=s.log,process.stdout.write(n+"\n")))},D.push_File=function(t){var e="";D.FLAG_SHOW_MESSAGE_TYPE&&(e+=D.messageTypes[t.level]+" "),e+=t.log+"\n";try{St.appendFileSync(D.logFile,e,"utf8")}catch(t){if(!(ct.caught(t).unwrap()instanceof Error))throw t;r.TERMINAL.ptag("<red> - NO SPACE LEFT FOR THE LOG FILE - <!>\n"),process.exit(1)}};var F=function(){};F.__name__="djNode.utils.CLIApp",F.quickExec=function(t,e,s){F.FLAG_LOG_QUIET||D.log("QuickExec : "+t+" | cwd : "+(null==e?process.cwd():e)),yt.exec(t,{cwd:e},function(t,e,i){s(null==t,e,i)})},F.quickExecS=function(t,e){try{return F.FLAG_LOG_QUIET||D.log("ExecSync : "+t+" | cwd : "+(null==e?process.cwd():e)),yt.execSync(t,{cwd:e,stdio:["ignore","pipe","ignore"]})}catch(t){return null}};var C=function(){};C.__name__="djNode.utils.ProcUtil",C.getTaskPIDs=function(t){var e=[];try{for(var i=yt.execSync("tasklist").toString().split("\n"),s=new c("(\\S+)\\s*(\\d+)","ig"),n=0;n<i.length;){var r=i[n];++n,s.match(r)&&s.matched(1).toLowerCase()==t.toLowerCase()&&e.push(s.matched(2))}}catch(n){}return e},C.killPID=function(t,e,i,s){null==s&&(s=!1),null==i&&(i=!1);var n="TASKKILL ";null!=t&&(e=[t]);for(var r=0;r<e.length;){var o=e[r];++r,n+="/PID "+o+" "}i&&(t+="/F "),s&&(t+="/T "),yt.execSync(n)},C.killTask=function(t,e){null==e&&(e=!1);try{var i="TASKKILL "+t;e&&(i+=" /F"),yt.execSync(i)}catch(t){}};function N(){}N.__name__="djTui.Align",N.prototype={screen:function(t,e,i,s){null==s&&(s=0),null==i&&(i="c"),null==e&&(e="c");var n=0,r=0;switch(e){case"c":n=P.width/2-t.width/2|0;break;case"l":n=s;break;case"r":n=P.width-t.width-s}switch(i){case"b":r=P.height-t.height-s;break;case"c":r=P.height/2-t.height/2|0;break;case"t":r=s}return t.pos(n,r),t},up:function(t,e,i,s){return null==s&&(s=0),null==i&&(i=0),t.move(e.x+i,e.y-t.height+s),t},down:function(t,e,i,s){return null==s&&(s=0),null==i&&(i=0),t.move(e.x+i,e.y+e.height+s),t},left:function(t,e,i,s){return null==s&&(s=0),null==i&&(i=0),t.move(e.x-t.width+i,e.y+s),t},right:function(t,e,i,s){return null==s&&(s=0),null==i&&(i=0),t.move(e.x+e.width+i,e.y+s),t},inLine:function(s,t,e,n,i){var r;null==i&&(i=0),null==n&&(n=0),null==e&&(e="c");function o(){for(var t=0,e=0;e<s.length;){var i=s[e];++e,t+=i.width}return t+=(s.length-1)*n}switch(e){case"c":r=i+(P.width/2-o()/2|0);break;case"l":r=i;break;case"r":r=i+P.width-o();break;default:throw ct.thrown("Not supported align type `"+e+"` Typo?")}for(var a=0;a<s.length;){var l=s[a];++a,l.pos(r,t),r+=l.width+n}},__class__:N};var G=function(t){this.focus_lock=!1,this.focusable=!0,this.lockDraw=!1,this.parent=null,this.isFocused=!1,this.colorBG=null,this.colorFG=null,this.height=0,this.width=0,this.y=0,this.x=0,this.UID=G.UID_GEN++,this.SID=t,this.set_visible(!1),null!=this.SID&&""!=this.SID||(this.SID="id_"+this.UID)};G.__name__="djTui.BaseElement",G.focusNext=function(t,e,i){if(null==i&&(i=!0),0==t.length)return!1;for(var s=t.indexOf(e),n=s;;){if(++n>=t.length){if(-1==s)return!1;if(!i)return!1;n=0}if(n==s)return!1;if(t[n].focusable&&t[n].visible)break}return t[n].focus(),!0},G.focusPrev=function(t,e,i){if(null==i&&(i=!0),0==t.length)return!1;var s=t.indexOf(e),n=s;for(-1==s&&(n=t.length);;){if(--n<0){if(-1==s)return!1;if(!i)return!1;n=t.length-1}if(n==s)return!1;if(t[n].focusable&&t[n].visible)break}return t[n].focus(),!0},G.prototype={kill:function(){this.parent=null},move:function(t,e){return this.x+=t,this.y+=e,this},pos:function(t,e){return this.move(t-this.x,e-this.y),this},posNext:function(t,e){return null==e&&(e=0),this.pos(t.x+t.width+e,t.y),this},setColor:function(t,e,i){return null!=t?(this.colorFG=t.fg,this.colorBG=t.bg):(this.colorFG=e,this.colorBG=i),null==this.colorBG&&null!=this.parent&&(this.colorBG=this.parent.colorBG),this},size:function(t,e){return this.width=t,this.height=e,this},focus:function(){!this.isFocused&&this.focusable&&(this.isFocused=!0,this.focusSetup(this.isFocused),this.callback("focus"),this.draw())},unfocus:function(){this.isFocused&&(this.isFocused=!1,this.focusSetup(this.isFocused),this.callback("unfocus"),this.draw())},callback:function(t,e){null==e&&(e=this),this.parent.onChildEvent(t,e)},onAdded:function(){},onKey:function(t){return t},focusSetup:function(t){},draw:function(){},clear:function(){this.lockDraw||(P.T.reset().bg(this.parent.colorBG),P.D.rect(this.x,this.y,this.width,this.height))},overlapsWith:function(t){return this.x+this.width>t.x&&this.x<t.x+t.width&&this.y+this.height>t.y&&this.y<t.y+t.height},_readyCol:function(){P.T.reset().fg(this.colorFG).bg(this.colorBG)},setData:function(t){},getData:function(){return null},reset:function(){},set_visible:function(t){return this.visible=t},toString:function(){return xt.getClass(this).__name__+(": SID:"+this.SID+", UID:"+this.UID+", pos("+this.x+","+this.y+"), size("+this.width+","+this.height)+")"},__class__:G,__properties__:{set_visible:"set_visible"}};function L(){}L.__name__="djTui.Draw",L.prototype={rect:function(t,e,i,s,n){null==n&&(n=" ");for(var r=d.lpad("",n,i),o=e,a=e+s;o<a;){var l=o++;P.T.move(t,l).print(r)}},border:function(t,e,i,s,n){null==n&&(n=1);var r=R.border[n];this.lineH(t+1,e,i-2,r.charAt(1)),this.lineH(t+1,e+s-1,i-2,r.charAt(4)),this.lineV(t,e+1,s-2,r.charAt(6)),this.lineV(t+i-1,e+1,s-2,r.charAt(7)),P.T.move(t,e).print(r.charAt(0)).moveR(i-2,0).print(r.charAt(2)),P.T.move(t,e+s-1).print(r.charAt(3)).moveR(i-2,0).print(r.charAt(5))},drawArray:function(t,e,i){for(var s=0,n=t.length;s<n;){var r=s++;P.T.move(e,i+r).print(t[r])}},lineH:function(t,e,i,s){null==s&&(s="-"),P.T.move(t,e).print(d.lpad("",s,i))},lineV:function(t,e,i,s){null==s&&(s="|"),P.T.move(t,e);for(var n=0;n<i;)P.T.move(t,e+n++).print(s)},drawGrid:function(h,t,e,i){for(var c=R.border[e],u=t,_=[],s=[],n=0,r=i.length;n<r;){if(i[m=n++]instanceof Array){var o=i[m];_[m]=o.slice()}else{for(var a=_,l=xt.__cast(i[m],String).split("|"),d=new Array(l.length),f=0,p=l.length;f<p;){d[g=f++]=v.parseInt(l[g])}a[m]=d}s[m]=_[m].shift()}u+=1,P.T.move(h,u-1).print(c.charAt(0));for(n=0,r=_[0].length;n<r;){var g=n++;P.T.print(x.rep(_[0][g],c.charAt(1))),P.T.print(c.charAt(g==_[0].length-1?2:8))}for(n=0,r=_.length;n<r;){for(var m,f=0,p=s[m=n++];f<p;){f++;!function(t){u+=1,P.T.move(h,u-1).print(c.charAt(7));for(var e=0,i=_[t].length;e<i;){var s=e++;P.T.moveR(_[t][s],0).print(c.charAt(7))}}(m)}!function(t){var e=t<_.length-1;u+=1,P.T.move(h,u-1).print(c.charAt(e?10:3));var i=[],s=0;if(e){for(var n=0,r=_[t+1];n<r.length;){var o=r[n];++n,s+=o+1,i.push(s)}i.pop()}for(var a=0,n=0,r=_[t].length;n<r;){var l=(o=n++)<_[t].length-1;a+=_[t][o]+1,P.T.print(x.rep(_[t][o],c.charAt(1))),l&&(0<=i.indexOf(a)?(P.T.print(c.charAt(12)),w.remove(i,a)):P.T.print(c.charAt(9)))}P.T.print(c.charAt(e?11:5));for(n=0;n<i.length;){o=i[n];++n,P.T.move(h+o,u-1).print(c.charAt(8))}}(m)}},__class__:L};var j=f["djTui.ElementType"]={__ename__:!0,__constructs__:["button","label","option","number","textbox","vlist","toggle","input","window"],button:{_hx_index:0,__enum__:"djTui.ElementType",toString:e},label:{_hx_index:1,__enum__:"djTui.ElementType",toString:e},option:{_hx_index:2,__enum__:"djTui.ElementType",toString:e},number:{_hx_index:3,__enum__:"djTui.ElementType",toString:e},textbox:{_hx_index:4,__enum__:"djTui.ElementType",toString:e},vlist:{_hx_index:5,__enum__:"djTui.ElementType",toString:e},toggle:{_hx_index:6,__enum__:"djTui.ElementType",toString:e},input:{_hx_index:7,__enum__:"djTui.ElementType",toString:e},window:{_hx_index:8,__enum__:"djTui.ElementType",toString:e}},R=function(){};R.__name__="djTui.Styles",R.init=function(){R.arrowsLR=["<>","◄►","←→","«»"],R.border=["             ","┌─┐└─┘││┬┴├┤┼","╔═╗╚═╝║║╦╩╠╣╬","╓─╖╙─╜║║╥╨╞╡╫","╒═╕╘═╛││╤╧╟╢╪","/-\\\\=/||--||T","█▀██▄█▌▐█▄▌▐█"],R.win=new mt;var t=R.win,e=R.createWinStyle("yellow","magenta","white","blue","darkblue");t.h["blue.1"]=e;t=R.win,e=R.createWinStyle("yellow","red","white","darkgreen","darkgray");t.h["green.1"]=e;t=R.win,e=R.createWinStyle("yellow","magenta","white","red","darkred");t.h["red.1"]=e;t=R.win,e=R.createWinStyle("black","cyan","black","magenta","darkcyan");t.h["magenta.1"]=e;t=R.win,e=R.createWinStyle("yellow","red","white","black","gray");t.h["black.1"]=e;t=R.win,e=R.createWinStyle("black","magenta","black","cyan","gray");t.h["cyan.1"]=e;t=R.win,e=R.createWinStyle("white","blue","black","gray","darkgray");t.h["gray.1"]=e},R.createWinStyle=function(t,e,i,s,n,r){return null==r&&(r=1),{bg:s,text:i,titleColor:{fg:t},borderStyle:r,borderColor:{fg:i},elem_focus:{fg:e,bg:t},elem_idle:{fg:i},elem_disable_f:{fg:s,bg:n},elem_disable_i:{fg:n},scrollbar_idle:{fg:i},scrollbar_focus:{fg:t,bg:e},textbox:{fg:i},vlist_cursor:{fg:s,bg:t}}};var P=function(){};P.__name__="djTui.WM",P.__properties__={set_backgroundColor:"set_backgroundColor"},P.create=function(t,e,i,s,n,r){null==s&&(s=0),null==i&&(i=0),P.width=i,P.height=s,P.I=t,P.T=e,P.D=new L,P.DB=new mt,P.A=new N,P.STATE=new K,P.width<=0&&(P.width=P.T.MAX_WIDTH),P.height<=0&&(P.height=P.T.MAX_HEIGHT),R.init(),null==n&&(n="blue.1"),null==r&&(r="red.1"),P.global_style_win=g.copyDeep(R.win.h[n]),P.global_style_pop=g.copyDeep(R.win.h[r]),P.I.onKey=P._onKey,P.I.start(),P.closeAll(),P._isInited=!0},P.closeAll=function(){P.win_list=[],P.active=P.active_last=null;for(var t=0,e=P.win_list;t<e.length;){var i=e[t];++t,i.set_visible(!1)}P.clearBG(),P.STATE.current=null},P.add=function(t,e){null==e&&(e=!1),t.x<0?t.pos(0,t.y):t.x+t.width>P.width&&t.pos(P.width-t.width,t.y),t.y<0?t.pos(t.x,0):t.y+t.height>P.height&&t.pos(t.x,P.height-t.height),-1==P.win_list.indexOf(t)&&P.win_list.push(t),t.set_visible(!0),t.draw(),e&&t.focusable&&t.focus()},P.addTiled=function(t,e){var i=0;null!=e&&(i=e.y+e.height),P.A.inLine(t,i);for(var s=0;s<t.length;){var n=t[s];++s,P.add(n)}},P.clearDB=function(){P.DB=new mt},P.focusNext=function(){return null!=P.active&&G.focusNext(P.win_list,P.active)},P.windowOverlapsWithAny=function(t){for(var e=0,i=P.win_list;e<i.length;){var s=i[e];if(++e,t!=s&&t.overlapsWith(s))return!0}return!1},P.clearBG=function(){P.T.reset(),P.T.bg(P.backgroundColor),P.D.rect(0,0,P.width,P.height)},P.popupConfirm=function(e,t,i){var s=new at(t,2,function(t){0==t&&e()});return s.flag_close_on_esc=!0,null==i?P.A.screen(s):s.pos(i[0],i[1]),null!=P.active?P.active.openSub(s,!0):s.open(!0,!0),s},P._onKey=function(t){null!=P.onKey&&(t=P.onKey(t)),null!=P.active&&(t=P.active.onKey(t)),"tab"==t?P.focusNext():"esc"==t&&P.STATE.handleESC()},P._onWindowEvent=function(t,e){switch(t){case"close":w.remove(P.win_list,e),P.T.reset(),P.T.bg(P.backgroundColor),P.D.rect(e.x,e.y,e.width,e.height);for(var i=0,s=P.win_list;i<s.length;){var n=s[i];++i,n.overlapsWith(e)&&n.draw()}P.active==e&&(P.active=null)!=P.active_last&&1==P.active_last.visible&&P.active_last.focus();break;case"focus":if(P.active==e)return;null!=P.active&&P.active.unfocus(),P.active_last=P.active,P.active=e,P.windowOverlapsWithAny(e)&&e.draw()}},P.set_backgroundColor=function(t){if(t==P.backgroundColor)return t;P.backgroundColor=t,P.clearBG();for(var e=0,i=P.win_list;e<i.length;){var s=i[e];++e,s.draw()}return t};var B=function(t,e,i,s){null==i&&(i=5),null==e&&(e=5),this.tab_mode=0,this.flag_return_focus_once=!1,this.flag_enter_goto_next=!1,this.flag_close_on_bksp=!1,this.flag_close_on_esc=!1,this.rPadY=0,this.rPadX=0,this.padY=0,this.padX=0,this.borderStyle=0,this.display_list=[],this.events=new M(this),null!=t&&(Object.prototype.hasOwnProperty.call(P.DB.h,t)||(P.DB.h[t]=this)),G.call(this,t),this.type=j.window,this.border_el=new Y,this.addChild(this.border_el),null!=s?this.setStyle(s):this.setStyle(P.global_style_win),this.size(e,i)};B.__name__="djTui.Window",B.__super__=G,B.prototype=i(G.prototype,{toString:function(){var t=G.prototype.toString.call(this);return t+=", padding ("+this.padX+", "+this.padY+"), childen("+this.display_list.length+")"},kill:function(){G.prototype.kill.call(this),this.lockDraw=!0,this.removeAll();var t=this.SID,e=P.DB;Object.prototype.hasOwnProperty.call(e.h,t)&&delete e.h[t]},setStyle:function(t){this.style!=t&&(this.style=g.copyDeep(t)),this.setColor(null,this.style.text,this.style.bg),this.border_el.setColor(this.style.borderColor),this.set_borderStyle(this.style.borderStyle)},modStyle:function(t,e){null==e&&(e=!1),this.setStyle(g.copyFields(t,this.style)),e&&this.draw()},getEl:function(t){for(var e=0,i=this.display_list;e<i.length;){var s=i[e];if(++e,s.SID==t)return s}return null},getElIndex:function(t){return this.display_list.length>t?this.display_list[t]:null},move:function(t,e){this.x+=t,this.y+=e;for(var i=0,s=this.display_list;i<s.length;){var n=s[i];++i,n.move(t,e)}return this.visible&&this.draw(),this},size:function(t,e){return t<0&&(t=Math.floor(P.width/-t)),e<0&&(e=Math.floor(P.height/-e)),G.prototype.size.call(this,t,e),this.border_el.size(t,e),this},padding:function(t,e){return null==e&&(e=-1),-1==e&&(e=t),this.rPadX=t,this.rPadY=e,this.padX=t,this.padY=e,0<this.borderStyle&&(this.padX++,this.padY++),this},addChild:function(t){return this.display_list.push(t),t.parent=this,t.onAdded(),t.set_visible(this.visible),t.focusable&&t.focusSetup(this.isFocused),this.visible&&!this.lockDraw&&t.draw(),t},removeAll:function(){for(var t=1,e=this.display_list.length;t<e;){var i=t++;this.display_list[i].kill()}this.display_list=[this.border_el],this.lastAdded=null,this.visible&&!this.lockDraw&&(this.clear(),this.draw())},removeChild:function(t){w.remove(this.display_list,t)&&(t.set_visible(!1),this.visible&&!this.lockDraw&&this.draw())},addStack:function(t,e,i){switch(null==i&&(i="l"),null==e&&(e=0),i){case"c":t.x=this.x+(this.width/2-t.width/2|0);break;case"l":t.x=this.x+this.padX;break;case"r":t.x=this.x+this.width-t.width}return null==this.lastAdded?t.y=this.y+this.padY+e:t.y=this.lastAdded.y+this.lastAdded.height+e,this.addChild(t),this.lastAdded=t},addStackInline:function(t,e,i,s){null==s&&(s="l"),null==i&&(i=1),null==e&&(e=0);for(var n=0,n=e<0?this.y+this.get_inHeight()+e+1:null==this.lastAdded?this.y+this.padY:this.lastAdded.y+this.lastAdded.height+e,r=0,o=0;o<t.length;){var a=t[o];++o,r+=a.width}r+=(t.length-1)*i;for(var l=0,l="c"==s?this.x+(this.width/2-r/2|0):this.x+this.padX,o=0,h=t.length;o<h;){t[a=o++].pos(l,n),l=t[a].x+t[a].width+i,this.addChild(t[a]),t[a].type==j.button&&(xt.__cast(t[a],Q).flag_leftright_escape=!0)}this.lastAdded=t[t.length-1]},addSeparator:function(t){null==t&&(t=0),0==t&&(t=this.borderStyle);var e=d.lpad("",R.border[t].charAt(1),this.get_inWidth()),i=new V(e,0,"center");this.addStack(i)},setPopupBehavior:function(){this.flag_close_on_esc=!0,this.flag_close_on_bksp=!0,this.focus_lock=!0},close:function(){0!=this.visible&&(this.set_visible(!1),this.unfocus(),P._onWindowEvent("close",this),this.callback("close"))},open:function(t,e){return null==e&&(e=!1),null==t&&(t=!1),e?this._openAnim():(this.callback("open"),P.add(this,t)),this},openSub:function(t,e){null==e&&(e=!1),this.flag_return_focus_once=!0,t.open(!0,e)},focus:function(){var t;this.focusable&&this.visible&&(null!=this.style.borderColor_focus&&(this.border_el.setColor(this.style.borderColor_focus),this.border_el.draw()),null!=this.style.titleColor_focus&&null!=this.title_el&&(this.title_el.setColor(this.style.titleColor_focus),this.title_el.draw()),P._onWindowEvent("focus",this),this.lockDraw=!0,G.prototype.focus.call(this),this.lockDraw=!1,0!=this.display_list.length&&(null==this.hack_always_focus_this?this.flag_return_focus_once&&null!=this.active_last?(this.active_last.focus(),this.flag_return_focus_once=!1):G.focusNext(this.display_list,null):null!=(t=this.getEl(this.hack_always_focus_this))&&t.focus()))},unfocus:function(){this.isFocused&&(null!=this.style.borderColor_focus&&(this.border_el.setColor(this.style.borderColor),this.border_el.draw()),null!=this.style.titleColor_focus&&null!=this.title_el&&(this.title_el.setColor(this.style.titleColor),this.title_el.draw()),null!=this.active&&this.active.unfocus(),this.active_last=this.active,this.active=null,this.lockDraw=!0,G.prototype.unfocus.call(this),this.lockDraw=!1)},draw:function(){if(!this.lockDraw&&this.visible){P.T.reset().fg(this.colorFG).bg(this.colorBG),P.D.rect(this.x,this.y,this.width,this.height);for(var t=0,e=this.display_list;t<e.length;){var i=e[t];++t,i.lockDraw||i.draw()}}},getActiveIndex:function(){if(null!=this.active)for(var t=0,e=this.display_list.length;t<e;){var i=t++;if(this.display_list[i]==this.active)return i}return-1},focusElement:function(t){null!=this.active&&this.active.unfocus(),this.active_last=this.active,this.active=t},_openAnim:function(){var n=this;null!=P.active&&P.active.unfocus();var r=[.3,.6],o=new ut(B.windowAnimationTick),a=0;o.run=function(){var t=Math.ceil(r[a]*n.width),e=Math.ceil(r[a]*n.height),i=Math.ceil(n.x+(n.width-t)/2),s=Math.ceil(n.y+(n.height-e)/2);P.T.reset().fg(n.colorFG).bg(n.colorBG),P.D.rect(i,s,t,e),0<n.borderStyle&&P.D.border(i,s,t,e,n.borderStyle),(a+=1)==r.length&&(o.stop(),n.open(!0,!1))}},focusNext:function(t){return null==t&&(t=!1),null!=this.active&&G.focusNext(this.display_list,this.active,t)},focusPrev:function(){return null!=this.active&&G.focusPrev(this.display_list,this.active,!1)},onKey:function(t){switch(t){case"backsp":if(this.flag_close_on_bksp)return this.close(),"";break;case"esc":if(this.callback("escape"),this.flag_close_on_esc)return this.close(),"";break;case"tab":if(0<this.tab_mode)return 2==this.tab_mode&&(this.flag_return_focus_once=!0),t;if(this.focus_lock)return this.focusNext(!0),"";if(this.focusNext())return""}if(null==this.active)return t;switch(t=this.active.onKey(t)){case"down":this.focusNext();break;case"home":case"pageup":G.focusNext(this.display_list,null,!1);break;case"end":case"pagedown":G.focusPrev(this.display_list,null,!1);break;case"up":this.focusPrev();break;default:return t}return t},onChildEvent:function(t,e){"focus"==t&&this.focusElement(e),this.events.trig(t,e)},callback:function(t,e){this.events.trig(t,this)},set_borderStyle:function(t){return this.borderStyle==t||(this.borderStyle=t,this.borderStyle>R.border.length-1&&(this.borderStyle=1),this.border_el.style=this.borderStyle,this.style.borderStyle=this.borderStyle,this.visible&&!this.lockDraw&&(this.border_el.draw(),null!=this.title_el&&this.title_el.draw()),this.padding(this.rPadX,this.rPadY)),t},set_visible:function(t){if(this.visible!=t)for(var e=0,i=this.display_list;e<i.length;){var s=i[e];++e,s.set_visible(t)}return this.visible=t},get_inWidth:function(){return this.width-this.padX-this.padX|0},get_inHeight:function(){return this.height-this.padY-this.padY|0},set_title:function(t){return this.title=t,this.lockDraw=!0,null!=this.title_el&&this.removeChild(this.title_el),this.title_el=new V("| "+this.title+" |"),this.title.length>this.get_inWidth()-4&&this.title_el.setTextWidth(this.get_inWidth()-4,"center"),this.title_el.setColor(this.style.titleColor),this.title_el.pos(this.x+(this.width/2-this.title_el.width/2|0),this.y),this.addChild(this.title_el),this.lockDraw=!1,this.visible&&(this.border_el.drawTop(),this.title_el.draw()),t},__class__:B,__properties__:i(G.prototype.__properties__,{get_inHeight:"get_inHeight",get_inWidth:"get_inWidth",set_borderStyle:"set_borderStyle",set_title:"set_title"})});var M=function(t){this.win=t};M.__name__="djTui.WindowEvents",M.prototype={trig:function(t,e){e.type==j.window?"focus"==t&&null!=this.onFocus?this.onFocus():"unfocus"==t&&null!=this.onUnfocus?this.onUnfocus():"open"==t&&null!=this.onOpen?this.onOpen():"close"==t&&null!=this.onClose&&this.onClose():null!=this.onElem&&this.onElem(t,e),null!=this.onAny&&this.onAny(t,e),null!=P.winEvents&&P.winEvents.trig(t,e)},__class__:M};function W(t,e){this.SID=t,this.list=null!=e?e:[]}W.__name__="djTui.WindowState",W.prototype={add:function(t){return this.list.push(t),t},addM:function(t){for(var e=0;e<t.length;){var i=t[e];++e,this.add(i)}},get:function(t){for(var e=0,i=this.list;e<i.length;){var s=i[e];if(++e,s.SID==t)return s}return null},close:function(){for(var t=0,e=this.list;t<e.length;){var i=e[t];++t,i.close()}null!=this.lastBgColor&&(P.set_backgroundColor(this.lastBgColor),this.lastBgColor=null)},open:function(t){null!=this.bgColor&&(this.lastBgColor=P.backgroundColor,P.set_backgroundColor(this.bgColor));for(var e=0,i=this.list;e<i.length;){var s=i[e];++e,s.open()}G.focusNext(this.list,null)},__class__:W};var K=function(){this.clear()};K.__name__="djTui.WindowStateManager",K.prototype={create:function(t,e){var i=new W(t,e);return this.save(i),i},save:function(t){Object.prototype.hasOwnProperty.call(this.states.h,t.SID)||(this.states.h[t.SID]=t)},goto:function(t,e){var i=this.states.h[t];null!=i&&this.open(i)},close:function(){null!=this.current&&(this.onStateClose(this.current),this.current.close(),this.current=null)},open:function(t){this.close(),this.onStateOpen(t),t.open(),this.current=t},onStateOpen:function(t){},onStateClose:function(t){},clear:function(){this.states=new mt,this.current=null},handleESC:function(){return null!=this.current&&null!=this.current.onEscGoto&&(this.goto(this.current.onEscGoto),!0)},__class__:K};function H(){}H.__name__="djTui.adaptors.IInput",H.__isInterface__=!0,H.prototype={__class__:H};function U(){}U.__name__="djTui.adaptors.ITerminal",U.__isInterface__=!0,U.prototype={__class__:U};var z=function(){};z.__name__="djTui.adaptors.djNode.InputObj",z.__interfaces__=[H],z.prototype={_onKey:function(t){var e,i=S.toKeyCodeID(t);if(null!=i){switch(i._hx_index){case 0:e="up";break;case 1:e="down";break;case 2:e="left";break;case 3:e="right";break;case 4:e="home";break;case 7:e="end";break;case 8:e="pageup";break;case 9:e="pagedown";break;case 10:e="backsp";break;case 11:e="tab";break;case 12:e="enter";break;case 13:e="space";break;case 14:e="esc";break;case 17:e="F1";break;case 18:e="F2";break;case 19:e="F3";break;case 20:e="F4";break;case 21:e="F5";break;default:e=""}this.onKey(e)}else this.onKey(t)},start:function(){k.startCapture(!0,Dt(this,this._onKey))},stop:function(){k.stop()},__class__:z};var X=function(){this.t=r.TERMINAL,this.MAX_WIDTH=this.t.getWidth(),this.MAX_HEIGHT=this.t.getHeight()};X.__name__="djTui.adaptors.djNode.TerminalObj",X.__interfaces__=[U],X.prototype={saveCursor:function(){this.t;process.stdout.write("[s")},restoreCursor:function(){this.t;process.stdout.write("[u")},setCursorSymbol:function(t){},print:function(t){return process.stdout.write(v.string(t)),this},move:function(t,e){return this.t.move(t+1,e+1),this},moveR:function(t,e){var i;return 0<t?(this.t,null==(i=t)&&(i=1),process.stdout.write("["+i+"C")):t<0&&(this.t,null==(i=-t)&&(i=1),process.stdout.write("["+i+"D")),0<e?(this.t,null==(t=e)&&(t=1),process.stdout.write("["+t+"B")):e<0&&(this.t,null==(t=-e)&&(t=1),process.stdout.write("["+t+"A")),this},fg:function(t){return this.t.fg(p.createEnum(E,t,null)),this},bg:function(t){return this.t.bg(p.createEnum(E,t,null)),this},resetFG:function(){this.t;return process.stdout.write("[39m"),this},resetBG:function(){this.t;return process.stdout.write("[49m"),this},reset:function(){this.t;return process.stdout.write("[0m"),this},bold:function(t){return t?this.t.bold():(this.t,process.stdout.write("[21m")),this},italics:function(t){return this},__class__:X};function q(t){this.s_padOut=0,this.s_padIn=0,this.disabled=!1,G.call(this,t),this.textAlign="c",this.textWidth=0}q.__name__="djTui.el.BaseMenuItem",q.__super__=G,q.prototype=i(G.prototype,{onAdded:function(){null==this.color_idle&&(this.color_idle=this.parent.style.elem_idle),null==this.color_focus&&(this.color_focus=this.parent.style.elem_focus),1==this.disabled&&this.set_disabled(!0)},focusSetup:function(t){t?this.setColor(this.color_focus):this.setColor(this.color_idle)},draw:function(){P.T.reset().fg(this.colorFG).bg(this.colorBG),P.T.move(this.x,this.y).print(this.rText)},disable:function(t,e){return null==e&&(e=!1),null==t&&(t=!0),this.set_disabled(t),e&&t?this.focusable=!1:t||(this.focusable=!0),this},setTextWidth:function(t,e){return this.textWidth=t,null!=e&&(this.textAlign=e),null!=this.text&&this.set_text(this.text),this},colorIdle:function(t,e){return this.color_idle={fg:t,bg:e},this.colorsRefresh(),this},colorFocus:function(t,e){return this.color_focus={fg:t,bg:e},this.colorsRefresh(),this},colorsRefresh:function(){null!=this.parent&&(this.focusSetup(this.isFocused),this.visible&&!this.lockDraw&&this.draw())},set_text:function(t){return null==t&&(t=""),this.text=t,null!=this.s_smb_l&&(t=this.s_smb_l+x.rep(this.s_padIn," ")+t+x.rep(this.s_padIn," ")+this.s_smb_r),0<this.s_padOut&&(t=x.rep(this.s_padOut," ")+t+x.rep(this.s_padOut," ")),null!=this.rText&&0==this.textWidth&&xt.__cast(t,String).length<this.rText.length&&this.visible&&this.clear(),0==this.textWidth?this.rText=t:this.rText=x.padString(t,this.textWidth,this.textAlign),this.width=this.rText.length,this.visible&&!this.lockDraw&&this.draw(),this.text},set_disabled:function(t){var e;return this.disabled=t,this.disabled||(this.focusable=!0),null!=this.parent&&(e=this.parent.style,this.disabled?(this.color_focus=e.elem_disable_f,this.color_idle=e.elem_disable_i):(this.color_idle=e.elem_idle,this.color_focus=e.elem_focus),this.colorsRefresh()),t},setSideSymbolPad:function(t,e){return this.s_padIn=e,this.s_padOut=t,null!=this.text&&this.set_text(this.text),this},setSideSymbols:function(t,e){null==e&&(e=" "),null==t&&(t=" "),this.s_smb_l=t,this.s_smb_r=e},__class__:q,__properties__:i(G.prototype.__properties__,{set_disabled:"set_disabled",set_text:"set_text"})});var Y=function(t,e){null==e&&(e=0),this.grid=null,G.call(this,t),this.focusable=!1,this.style=e};Y.__name__="djTui.el.Border",Y.__super__=G,Y.prototype=i(G.prototype,{drawTop:function(){P.T.reset().fg(this.colorFG).bg(this.colorBG),P.D.lineH(this.x+1,this.y,this.width-2,R.border[this.style].charAt(1))},draw:function(){if(P.T.reset().fg(this.colorFG).bg(this.colorBG),null==this.grid){if(this.height<2)return;P.D.border(this.x,this.y,this.width,this.height,this.style)}else P.D.drawGrid(this.x,this.y,this.style,this.grid)},__class__:Y});var Q=function(t,e,i,s,n){var r;null==n&&(n=1),null==s&&(s=0),null==i&&(i=0),this.flag_leftright_escape=!1,q.call(this,t),this.type=j.button,this.height=n,this.textWidth=s,0<i&&(r=i-1,this.setSideSymbolPad(1,1),this.setSideSymbols(Q.SMB[r].charAt(0),Q.SMB[r].charAt(1))),this.set_text(e),null!=t&&0<=["#","@"].indexOf(t.charAt(0))&&this.extra(t)};Q.__name__="djTui.el.Button",Q.__super__=q,Q.prototype=i(q.prototype,{draw:function(){if(this.height<2)q.prototype.draw.call(this);else{P.T.reset().fg(this.colorFG).bg(this.colorBG);for(var t=.5*this.height|0,e=x.rep(this.width," "),i=0,s=this.height;i<s;){var n=i++;P.T.move(this.x,this.y+n),P.T.print(n==t?this.rText:e)}}},extra:function(t){null==this.xtr&&(this.xtr={});for(var e=0,i=t.split(",");e<i.length;){var s=i[e];++e;var n=w.substr(s,1,null);switch(s.charAt(0)){case"#":this.xtr.call=0,this.xtr.sid=n;break;case"?":this.xtr.conf=!0,this.xtr.confQ=n,x.isEmpty(this.xtr.confQ)&&(this.xtr.confQ=Q.CONF_DEF);break;case"@":this.xtr.call=1,this.xtr.sid=n;break;case"x":this.xtr.x=v.parseInt(n);break;case"y":this.xtr.y=v.parseInt(n);break;default:switch(s){case"anim":this.xtr.anim=!0;break;case"center":this.xtr.center=!0;break;case"close":this.xtr.close=!0}}}return this},confirm:function(t,e){var i="?";return null!=t&&(i+=t),null!=e&&(i+=",center"),this.extra(i)},action:function(){var t,e=this;if(null!=this.xtr){if(null!=this.xtr.call&&0==this.xtr.call)return void P.STATE.goto(this.xtr.sid);null!=this.xtr.close&&this.parent.close(),null==this.xtr.call||1!=this.xtr.call||null!=(t=P.DB.h[this.xtr.sid])&&(null!=this.xtr.x&&null!=this.xtr.y?t.pos(this.xtr.x,this.xtr.y):null!=this.xtr.center&&P.A.screen(t),t.open(!0,null!=this.xtr.anim))}this.callback("fire"),null!=this._onPush&&ut.delay(function(){e._onPush()},1)},onKey:function(t){return this.disabled||("enter"==t||"space"==t?(t="",null!=this.xtr&&null!=this.xtr.conf?P.popupConfirm(Dt(this,this.action),this.xtr.confQ,null==this.xtr.center?[this.x,this.y+1]:null):this.action()):this.flag_leftright_escape&&("left"==t?t="up":"right"==t&&(t="down"))),t},getData:function(){return this.SID},onPush:function(t){return this._onPush=t,this},__class__:Q});var V=function(t,e,i){null==i&&(i="l"),null==e&&(e=0),null==t&&(t=""),q.call(this),this.type=j.label,this.focusable=!1,this.textWidth=e,this.textAlign=i,this.height=1,this.set_text(t)};V.__name__="djTui.el.Label",V.__super__=q,V.prototype=i(q.prototype,{reset:function(){this.set_text("")},setSID:function(t){return this.SID=t,this},onAdded:function(){q.prototype.onAdded.call(this),null==this.colorFG?this.setColor(null,this.parent.colorFG):null==this.colorBG&&(this.colorBG=this.parent.colorBG)},scroll:function(t){null==t&&(t=250);var i=this;return this.anim_stop(),this.an={timer:null,r0:0,loops:-1,freq:t,tick:function(){i.an.r0++,i.an.r0>=i.text.length&&(i.an.r0=0);for(var t=0,e=[];t<i.width;)e[t]=i.text.charAt((i.an.r0+t)%i.text.length),++t;i.rText=e.join(""),i.draw()}},this.visible&&this.anim_start(),this},blink:function(t,e){null==e&&(e=250),null==t&&(t=-1);var i=this;return this.anim_stop(),this.an={timer:null,r0:0,loops:t,freq:e,tick:function(){0==i.an.r0?i.an.r0++:i.an.r0=0,0==i.an.r0?i.rText=x.padString("",i.width):i.rText=x.padString(i.text,i.width),i.draw()}},this.visible&&this.anim_start(),this},anim_start:function(){var t=this;null!=this.an&&(this.an.timer=new ut(this.an.freq),this.an.timer.run=function(){0!=t.an.loops?(t.an.tick(),0<t.an.loops&&t.an.loops--):(t.anim_stop(),t.an=null)},this.an.timer.run())},anim_stop:function(){null!=this.an&&null!=this.an.timer&&(this.an.timer.stop(),this.an.timer=null)},set_visible:function(t){return this.visible==t||(this.visible=t,this.visible?this.anim_start():this.anim_stop()),t},setData:function(t){this.set_text(t)},getData:function(){return this.text},__class__:V});function Z(t,e,i,s){null==s&&(s=0),null==i&&(i=4),q.call(this,t),this.type=j.option,this.options=e.slice(),this.height=1,this.w_slots=i,this.w_maxW=this.options[0].length;for(var n=0,r=this.options.length;n<r;){var o=n++;this.options[o].length>this.w_maxW&&(this.w_maxW=this.options[o].length)}this.setSideSymbolPad(0,1),this.setSideSymbols("[","]"),this.setData(s)}Z.__name__="djTui.el.PopupOption",Z.__super__=q,Z.prototype=i(q.prototype,{onAdded:function(){q.prototype.onAdded.call(this),this.createPopup(this.w_maxW+1,this.w_slots)},createPopup:function(t,e){var i=this;t<15&&(t=15);var s=this.parent.style;this.win=new B(null,null,null,s),this.win.padding(0,0).size(t,e+2),this.win.focus_lock=!0,this.win.flag_close_on_esc=!0,this.win.modStyle({bg:s.elem_focus.fg,vlist_cursor:{fg:s.elem_focus.bg,bg:s.bg}}),this.list=new nt("list",this.win.get_inWidth(),this.win.height-2),this.list.setData(this.options),this.list.onSelect=function(t){i.setData(t.index),i.win.close(),i.callback("change")},this.win.addStack(this.list)},onKey:function(t){return!this.disabled&&("space"==t||"enter"==t)?(this.list.cursor_to(this.index),this.win.pos(this.x+1,this.y-Math.floor(this.win.height/3)),this.parent.openSub(this.win),""):t},setData:function(t){this.index=t,this.set_text(this.options[this.index])},getData:function(){return this.index},__class__:Z});function J(t){null==t&&(t=8),this.scroll_ratio=0,G.call(this),this.height=t,this.focusable=!1}J.__name__="djTui.el.ScrollBar",J.__super__=G,J.prototype=i(G.prototype,{onAdded:function(){G.prototype.onAdded.call(this),null==this.colorFG&&this.setColor(this.parent.style.scrollbar_idle)},set_scroll_ratio:function(t){return this.scroll_ratio==t?t:(this.scroll_ratio=t,this.scroll_ratio<0?this.scroll_ratio=0:1<this.scroll_ratio&&(this.scroll_ratio=1),this.visible&&!this.lockDraw&&this.draw(),this.scroll_ratio)},draw:function(){if(this.visible){P.T.reset().fg(this.colorFG).bg(this.colorBG);for(var t=0,e=this.height;t<e;){var i=t++;P.T.move(this.x,this.y+i).print(J.SYMBOL_BAR)}var s=Math.ceil(this.height*this.scroll_ratio)-1;s<0&&(s=0),P.T.move(this.x,this.y+s).print(J.SYMBOL_IND)}},__class__:J,__properties__:i(G.prototype.__properties__,{set_scroll_ratio:"set_scroll_ratio"})});var $=function(t,e,i,s,n){null==n&&(n=0),null==s&&(s=1),null==i&&(i=10),null==e&&(e=0),this.arrowStyle=1,q.call(this,t),this.ar_stat=[!1,!1],this.type=j.number,this.min=e,this.max=i,this.inc=s,this.height=1,this.setSideSymbolPad(1,1),0==n&&(n=this.min),this.setData(n)};$.__name__="djTui.el.SliderNum",$.__super__=q,$.prototype=i(q.prototype,{set_arrowStyle:function(t){return this.arrowStyle=t,this.visible&&this.updateText(),t},updateText:function(){this.isFocused?this.setSideSymbols(this.ar_stat[0]?R.arrowsLR[this.arrowStyle].charAt(0):null,this.ar_stat[1]?R.arrowsLR[this.arrowStyle].charAt(1):null):this.setSideSymbols(),this.set_text(v.string(this.data))},focusSetup:function(t){q.prototype.focusSetup.call(this,t),this.lockDraw=!0,this.updateText(),this.lockDraw=!1},onKey:function(t){if(this.disabled)return t;switch(t){case"end":this.data!=this.max&&this.sd(this.max),t="";break;case"enter":this.callback("fire"),t=this.parent.flag_enter_goto_next?"down":"";break;case"home":this.data!=this.min&&this.sd(this.min),t="";break;case"left":this.data!=this.min&&this.sd(this.data-this.inc),t="";break;case"right":this.data!=this.max&&this.sd(this.data+this.inc),t=""}return t},sd:function(t){this.setData(t),this.callback("change")},setData:function(t){var e;if("string"==typeof t){if(e=parseFloat(t),isNaN(e))return}else e=t;this.data=m.roundFloat(e,2),this.data<this.min?this.data=this.min:this.data>this.max&&(this.data=this.max),this.ar_stat[0]=this.data!=this.min,this.ar_stat[1]=this.data!=this.max,this.updateText()},getData:function(){return this.data},__class__:$,__properties__:i(q.prototype.__properties__,{set_arrowStyle:"set_arrowStyle"})});var tt=function(t,e,i){null==i&&(i=0),this.arrowStyle=1,q.call(this,t),this.ar_stat=[!1,!1],this.type=j.option,this.options=e.slice(),this.index_max=this.options.length-1,this.height=1,this.setSideSymbolPad(1,1),this.setData(i)};tt.__name__="djTui.el.SliderOption",tt.__super__=q,tt.prototype=i(q.prototype,{set_arrowStyle:function(t){return this.arrowStyle=t,this.visible&&this.updateText(),t},focusSetup:function(t){q.prototype.focusSetup.call(this,t),this.lockDraw=!0,this.updateText(),this.lockDraw=!1},onKey:function(t){if(this.disabled)return t;switch(t){case"end":this.index!=this.index_max&&this.sd(this.index_max),t="";break;case"enter":this.callback("fire"),t=this.parent.flag_enter_goto_next?"down":"";break;case"home":0!=this.index&&this.sd(0),t="";break;case"left":0!=this.index&&this.sd(this.index-1),t="";break;case"right":this.index!=this.index_max&&this.sd(this.index+1),t=""}return t},sd:function(t){this.setData(t),this.callback("change")},updateText:function(){this.isFocused?this.setSideSymbols(this.ar_stat[0]?R.arrowsLR[this.arrowStyle].charAt(0):null,this.ar_stat[1]?R.arrowsLR[this.arrowStyle].charAt(1):null):this.setSideSymbols(),this.set_text(this.options[this.index])},setData:function(t){var e=0;if("string"==typeof t){if(-1==(e=this.options.indexOf(t)))return}else e=t;this.index=e,this.ar_stat[0]=0!=this.index,this.ar_stat[1]=this.index!=this.index_max,this.updateText()},getData:function(){return this.index},getSelected:function(){return this.options[this.index]},__class__:tt,__properties__:i(q.prototype.__properties__,{set_arrowStyle:"set_arrowStyle"})});function et(t,e,i){null==i&&(i=0),this.flag_scrollbar_autohide=!0,this.flag_add_scrollbar=!1,G.call(this,t),this.type=j.textbox,this.size(e-1,i),this.slots_count=this.height,this.reset(),this.focus_lock=!0}et.__name__="djTui.el.TextBox",et.__super__=G,et.prototype=i(G.prototype,{reset:function(){this.lines=[],this.set_scroll_offset(0),this.scroll_ratio=0,this.flag_empty=!0,null!=this.scrollbar&&(this.parent.removeChild(this.scrollbar),this.scrollbar.clear(),this.scrollbar=null),this.visible&&this.draw()},draw:function(){P.T.reset().fg(this.colorFG).bg(this.colorBG);for(var t=0;;){if(null==this.lines[t+this.scroll_offset]){P.D.rect(this.x,this.y+t,this.width,this.slots_count-t);break}if(this.drawSlotIndex(t),!(++t<this.slots_count))break}},addLine:function(t){this.flag_empty=!1,this.lines.push(x.padString(t,this.width)),this.scroll_max=this.lines.length-this.slots_count,this.scroll_max<0&&(this.scroll_max=0),0<this.scroll_max&&(this.addScrollbar(),this.set_scroll_offset(this.scroll_offset)),this.visible&&this.draw()},setData:function(t){var e;if(this.reset(),"string"==typeof t)e=x.splitToLines(t,this.width);else{if(!(t instanceof Array))throw ct.thrown("Unsupported Data Type for Textbox");e=t}for(var i=0;i<e.length;){var s=e[i];++i,this.lines.push(x.padString(s,this.width))}0==this.height&&(this.height=e.length,this.slots_count=this.height),this.scroll_max=this.lines.length-this.slots_count,this.scroll_max<0&&(this.scroll_max=0),0<this.scroll_max&&this.addScrollbar(),this.flag_empty=0==this.lines.length,this.visible&&!this.lockDraw&&this.draw()},scrollUp:function(){if(0==this.scroll_offset)return!1;return this.set_scroll_offset(this.scroll_offset-1),!0},scrollDown:function(){if(this.scroll_offset==this.scroll_max)return!1;return this.set_scroll_offset(this.scroll_offset+1),!0},scrollPageUp:function(){this.set_scroll_offset(this.scroll_offset-Math.floor(this.slots_count/2))},scrollPageDown:function(){this.set_scroll_offset(this.scroll_offset+Math.floor(this.slots_count/2))},scrollTop:function(){this.set_scroll_offset(0)},scrollBottom:function(){this.set_scroll_offset(this.scroll_max)},drawSlotIndex:function(t){P.T.move(this.x,this.y+t).print(this.lines[t+this.scroll_offset])},addScrollbar:function(){null==this.scrollbar&&(null!=this.parent?(this.scrollbar=new J(this.height),this.scrollbar.posNext(this),this.parent.addChild(this.scrollbar),this.focusSetup(this.isFocused),this.flag_add_scrollbar=!1):this.flag_add_scrollbar=!0)},onKey:function(t){if(this.flag_empty)return"up"==t?"left":"down"==t?"right":t;switch(t){case"down":this.scrollDown()&&(t="");break;case"end":this.scrollBottom(),t="";break;case"home":this.scrollTop(),t="";break;case"left":t="up";break;case"pagedown":this.scrollPageDown(),t="";break;case"pageup":this.scrollPageUp(),t="";break;case"right":t="down";break;case"up":this.scrollUp()&&(t="")}return t},onAdded:function(){null==this.colorFG&&this.setColor(this.parent.style.textbox),this.flag_add_scrollbar&&this.addScrollbar()},focusSetup:function(t){null!=this.parent.style.textbox_focus&&(t?this.setColor(this.parent.style.textbox_focus):this.setColor(this.parent.style.textbox)),null!=this.scrollbar&&(this.flag_scrollbar_autohide&&!t?(this.scrollbar.setColor(null,this.colorBG,this.colorBG),this.scrollbar.draw()):null!=this.parent.style.scrollbar_focus&&(t?this.scrollbar.setColor(this.parent.style.scrollbar_focus):this.scrollbar.setColor(this.parent.style.scrollbar_idle),this.scrollbar.draw()))},get_linesCount:function(){return this.lines.length},set_scroll_offset:function(t){return t<0&&(t=0),t>this.scroll_max&&(t=this.scroll_max),this.scroll_offset=t,this.scroll_ratio=this.scroll_offset/this.scroll_max,null!=this.scrollbar&&this.scrollbar.set_scroll_ratio(this.scroll_ratio),this.visible&&!this.lockDraw&&this.draw(),this.visible&&(null!=this.onScroll&&this.onScroll(this),this.callback("scroll")),t},__class__:et,__properties__:i(G.prototype.__properties__,{get_linesCount:"get_linesCount",set_scroll_offset:"set_scroll_offset"})});var it=function(t,e,i){null==i&&(i="all"),null==e&&(e=0),this.validKeys=null,q.call(this,t),this.type=j.input,this.caret_symbol="▄",this.maxChars=e,this.maxChars<1&&(this.maxChars=12),this.height=1,this.validKeys="number"==i?it.BANK_NUMBERS:it.BANK_LETTERS+it.BANK_NUMBERS,this.setSideSymbolPad(0,0),this.setSideSymbols(":",""),this.setTextWidth(this.maxChars+1,"l"),this.set_text("")};it.__name__="djTui.el.TextInput",it.__super__=q,it.prototype=i(q.prototype,{onAdded:function(){q.prototype.onAdded.call(this),this.maxChars<=0&&(this.maxChars=this.width-1)},focusSetup:function(t){q.prototype.focusSetup.call(this,t),t?this.caret_start():this.caret_stop()},set_visible:function(t){return this.visible=t,this.visible||this.caret_stop(),t},caret_start:function(){var t=this;this.caret_stop(),this.caret_tim=new ut(200),this.caret_tim.run=function(){t.caret_on=!t.caret_on,P.T.reset().fg(t.colorFG).bg(t.colorBG),P.T.move(t.x+t.text.length+t.s_padOut+t.s_padIn+t.s_smb_l.length,t.y),t.caret_on?P.T.print(t.caret_symbol):P.T.print(" ")}},caret_stop:function(){null!=this.caret_tim&&(this.caret_tim.stop(),this.caret_tim=null),this.caret_on=!1},onKey:function(t){if(this.disabled)return t;switch(t){case"backsp":0<this.text.length&&this.set_text(w.substr(this.text,0,-1)),this.draw(),t="";break;case"enter":this.callback("fire"),t=this.parent.flag_enter_goto_next?"down":"";break;case"space":(e=this).set_text(e.text+" "),this.draw(),t="";break;default:var e;1==t.length&&0<=this.validKeys.indexOf(t)&&((e=this).set_text(e.text+t),this.draw(),t="")}return t},set_text:function(t){return null!=t&&xt.__cast(t,String).length==this.maxChars?this.text:(this.caret_on=!1,q.prototype.set_text.call(this,t),t)},getData:function(){return this.text},setData:function(t){this.set_text(t)},__class__:it});var st=function(t,e){null==e&&(e=!1),this.TOGGLE_SYMBOL="■",q.call(this,t),this.type=j.toggle,this.height=1,this.setSideSymbolPad(2,0),this.setSideSymbols("[","]"),this.setData(e)};st.__name__="djTui.el.Toggle",st.__super__=q,st.prototype=i(q.prototype,{setData:function(t){this.data=t,this.data?this.set_text(this.TOGGLE_SYMBOL):this.set_text(" ")},getData:function(){return this.data},onKey:function(t){return this.disabled||"space"!=t&&"enter"!=t||(this.setData(!this.data),this.callback("change"),t=""),t},__class__:st});var nt=function(t,e,i){this.scrollPad=1,this.flag_ghost_active=!1,this.flag_letter_jump=!1,et.call(this,t,e,i),this.type=j.vlist,this.focusable=!0};nt.__name__="djTui.el.VList",nt.__super__=et,nt.prototype=i(et.prototype,{onAdded:function(){et.prototype.onAdded.call(this),this.scrollPad>Math.floor(this.slots_count/2)-1&&(this.scrollPad=Math.floor(this.slots_count/2)-1),null==this.color_cursor&&(this.color_cursor=this.parent.style.vlist_cursor)},setColorCursor:function(t,e){this.color_cursor={fg:t,bg:e}},draw:function(){et.prototype.draw.call(this),this.isFocused&&!this.flag_empty&&this.cursor_draw(),!this.isFocused&&this.flag_ghost_active&&(P.T.reset().fg(this.parent.style.elem_disable_f.fg).bg(this.parent.style.elem_disable_f.bg),this.drawSlotIndex(this.index_slot))},fire:function(){var t=this;this.callback("fire"),null!=this.onSelect&&ut.delay(function(){t.onSelect(t)},1)},onKey:function(t){if(this.flag_empty)return et.prototype.onKey.call(this,t);switch(t){case"down":this.cursor_down()&&(t="");break;case"end":this.cursor_bottom(),t="";break;case"enter":case"space":this.fire(),t="";break;case"home":this.cursor_top(),t="";break;case"left":t="up";break;case"pagedown":this.cursor_pageDown(),t="";break;case"pageup":this.cursor_pageUp(),t="";break;case"right":t="down";break;case"up":this.cursor_up()&&(t="")}if(!this.flag_letter_jump)return t;var e=t.toUpperCase();if(this.lines[this.index].charAt(0).toUpperCase()==e&&null!=this.lines[this.index+1]&&this.lines[this.index+1].charAt(0).toUpperCase()==e)return this.cursor_down(),"";for(var i=0;;){if(this.lines[i].charAt(0).toUpperCase()==e)return this.cursor_to(i),"";if(!(++i<this.lines.length))break}return t},reset:function(){et.prototype.reset.call(this),this.index=0,this.index_slot=0},getData:function(){return this.index},add:function(t){return this.addLine(t),this.get_index_max()},getSelectedText:function(){return null!=this.lines[this.index]?this.lines[this.index]:""},cursor_to:function(t){if(t!=this.index){for(null!=this.scrollbar&&(this.scrollbar.lockDraw=!0),this.lockDraw=!0,this.cursor_top();this.index<t;)this.cursor_down();this.lockDraw=!1,this.visible&&this.draw(),null!=this.scrollbar&&(this.scrollbar.lockDraw=!1,this.visible&&this.scrollbar.draw())}},cursor_draw:function(){this.lockDraw||(P.T.reset().fg(this.color_cursor.fg).bg(this.color_cursor.bg),this.drawSlotIndex(this.index_slot))},draw_current_slot_unfocused:function(){this.lockDraw||(P.T.reset().fg(this.colorFG).bg(this.colorBG),this.drawSlotIndex(this.index_slot))},cursor_up:function(){return 0!=this.index&&(this.index--,this.index_slot<=this.scrollPad&&0<this.scroll_offset?this.scrollUp():(this.draw_current_slot_unfocused(),this.index_slot--),this.cursor_draw(),this.callback("change"),!0)},cursor_down:function(){return this.index!=this.get_index_max()&&(this.index++,this.index_slot>=this.slots_count-this.scrollPad-1&&this.scroll_offset<this.scroll_max?this.scrollDown():(this.draw_current_slot_unfocused(),this.index_slot++),this.cursor_draw(),this.callback("change"),!0)},cursor_top:function(){0!=this.index&&((this.index=0)==this.scroll_offset?(this.draw_current_slot_unfocused(),this.index_slot=0,this.cursor_draw()):(this.index_slot=0,this.scrollTop()),this.callback("change"))},cursor_bottom:function(){this.index!=this.get_index_max()&&(this.index=this.get_index_max(),this.scroll_offset==this.scroll_max?(this.draw_current_slot_unfocused(),this.lines.length<this.slots_count?this.index_slot=this.get_index_max():this.index_slot=this.slots_count-1,this.cursor_draw()):(this.index_slot=this.slots_count-1,this.scrollBottom()),this.callback("change"))},cursor_pageUp:function(){if(0!=this.index){if(this.index_slot>this.scrollPad&&0<this.scroll_offset)this.draw_current_slot_unfocused(),this.index_slot=this.scrollPad,this.index=this.scroll_offset+this.index_slot,this.cursor_draw();else{if(0==this.scroll_offset)return void this.cursor_top();this.index_slot=this.scrollPad,this.scrollPageUp(),this.index=this.scroll_offset+this.index_slot}this.callback("change")}},cursor_pageDown:function(){if(this.index!=this.get_index_max()){if(this.index_slot<this.slots_count-this.scrollPad-1&&this.scroll_offset<this.scroll_max)this.draw_current_slot_unfocused(),this.index_slot=this.slots_count-this.scrollPad-1,this.index=this.scroll_offset+this.index_slot,this.cursor_draw();else{if(this.scroll_offset==this.scroll_max)return void this.cursor_bottom();this.index_slot=this.slots_count-1-this.scrollPad,this.scrollPageDown(),this.index=this.scroll_offset+this.index_slot}this.callback("change")}},get_index_max:function(){return this.lines.length-1},__class__:nt,__properties__:i(et.prototype.__properties__,{get_index_max:"get_index_max"})});var rt=function(t,e){null==t&&(t=-1),this.ST={bg:null,textfg:"white",textbg:"darkblue",align:"l",pad:1,smb:"[]"},B.call(this,null,t,1),this.focusable=!1,this.set_borderStyle(0),this.ST=g.copyFields(e,this.ST),null!=this.ST.bg&&this.modStyle({bg:this.ST.bg})};rt.__name__="djTui.win.ControlsHelpBar",rt.__super__=B,rt.prototype=i(B.prototype,{setData:function(t){var e="string"==typeof t?xt.__cast(t,String).split("|"):t;this.lockDraw=!0,null!=this.labels&&this.removeAll(),this.labels=[];for(var i=0;i<e.length;){var s=e[i];++i;var n=s.split(":"),r=new V(n[0]+" "+this.ST.smb.charAt(0)+n[1]+this.ST.smb.charAt(1));r.setColor(null,this.ST.textfg,this.ST.textbg),this.labels.push(r)}this.lockDraw=!1,P.T.reset().bg(this.style.bg),P.D.rect(this.x,this.y,this.width,this.height),this.addStackInline(this.labels,0,this.ST.pad,this.ST.align)},__class__:rt});var ot=function(t,e,i,s){null==i&&(i=3),null==e&&(e=1),this.bSt={bs:0,grid:!1,align:"l",bWidth:0,bSmb:[0,0,0],pads:[1,1],colbg:"",colfg:""},B.call(this,t,e,i),this.bSt=g.copyFields(s,this.bSt);var n=""==this.bSt.colbg?this.style.bg:this.bSt.colbg,r=""==this.bSt.colfg?this.style.text:this.bSt.colfg;this.modStyle({borderStyle:this.bSt.bs,bg:n,elem_idle:{fg:r},elem_focus:{fg:n,bg:r}}),this.bSt.grid&&(this.bSt.pads=[0,1]),this.padding(this.bSt.pads[0],0)};ot.__name__="djTui.win.MenuBar",ot.__super__=B,ot.prototype=i(B.prototype,{setItems:function(t){if(null==t)return this;if(this.currentIndex=0,null!=this.items){this.lockDraw=!0;for(var e=0,i=this.items;e<i.length;){var s=i[e];++e,this.removeChild(s)}this.lastAdded=null,this.lockDraw=!1}this.items=[];for(var n=2*this.bSt.pads[0],e=0,i=t.length;e<i;){var s=e++,r=new Q(""+s,t[s],this.bSt.bSmb[0],0<=this.bSt.bWidth?this.bSt.bWidth:0);r.height=this.get_inHeight(),r.setSideSymbolPad(this.bSt.bSmb[1],this.bSt.bSmb[2]),n+=r.width+this.bSt.pads[1],this.items.push(r)}if(this.bSt.bWidth<0&&this.width>n)for(var o=0;n<this.width;)this.items[o].setTextWidth(this.items[o].width+1),++o>=this.items.length&&(o=0),++n;if(this.bSt.grid){for(var a=[this.get_inHeight()],e=0,i=t.length;e<i;){s=e++;a.push(this.items[s].width)}this.border_el.grid=[a]}return n>this.width&&this.size(n,this.height),this.addStackInline(this.items,0,this.bSt.pads[1],this.bSt.align),this},setData:function(t){this.setItems(xt.__cast(t,String).split(","))},setIndex:function(t){t>this.items.length-1&&(t=this.items.length-1),t==this.currentIndex||t<0||(this.currentIndex=t,this.items[this.currentIndex].focus())},getIndex:function(){return this.currentIndex},drawTaller:function(t){P.T.bg(t.colorBG),P.D.rect(t.x,t.y+1,t.width,1),P.D.rect(t.x,t.y-1,t.width,1)},onChildEvent:function(t,e){var i=this;B.prototype.onChildEvent.call(this,t,e),"fire"==t&&null!=this.onSelect?null!=this.onSelect&&ut.delay(function(){i.onSelect(i.currentIndex)},1):"focus"==t&&(this.currentIndex=v.parseInt(e.SID),null!=this.onChange&&this.onChange(this.currentIndex))},onKey:function(t){return"down"!=t&&"up"!=t||(t=""),B.prototype.onKey.call(this,t)},__class__:ot});var at=function(t,e,i,s,n){switch(null==s&&(s=30),this.flag_auto_close=!0,null==n&&(n=P.global_style_pop),B.call(this,null,null,null,n),this.mbType=e,this.onSelect=i,this.focus_lock=!0,this.padding(1,0),this.tbox=new et(null,s-2,0),this.tbox.setData(t),this.tbox.focusable=!1,this.buttons=[],this.mbType){case-1:break;case 0:this.add_b("OK");break;case 1:this.add_b("OK"),this.add_b("CANCEL");break;case 2:this.add_b("YES"),this.add_b("NO");break;default:this.flag_close_on_esc=!0}this.size(s,this.tbox.height+5),this.addStack(this.tbox,1),this.addStackInline(this.buttons,1,3,"c"),at.FOCUS_LAST&&null!=this.lastAdded&&(this.hack_always_focus_this=this.lastAdded.SID)};at.__name__="djTui.win.MessageBox",at.create=function(t,e,i,s,n){null==s&&(s=30);var r=new at(t,e,i,s,n);return P.A.screen(r),r},at.__super__=B,at.prototype=i(B.prototype,{onChildEvent:function(t,e){B.prototype.onChildEvent.call(this,t,e),"fire"==t&&(this.flag_auto_close&&this.close(),null!=this.onSelect&&this.onSelect(this.buttons.indexOf(e)))},add_b:function(t){var e=new Q(null,t,at.BUTTON_STYLE);e.flag_leftright_escape=!0,this.buttons.push(e)},__class__:at});var lt=function(t,e,i,s){null==i&&(i=-2),null==e&&(e=-2),B.call(this,t,e,i,s),this.labelMap=new gt,this.align="none",this.align_padx=1,this.setLabelFocusColor(this.style.elem_focus.bg,this.style.elem_focus.fg)};lt.__name__="djTui.win.WindowForm",lt.__super__=B,lt.prototype=i(B.prototype,{setAlign:function(t,e,i){return null==i&&(i=-2),null==e&&(e=1),this.align=t,this.align_padx=e,this.align_fix_start=i,this.align_fix_start<0&&(this.align_fix_start=Math.floor(this.get_inWidth()/-this.align_fix_start)),this},add:function(t,e){var i=new V(t);switch(i.color_focus=this.colorLabelFocus,this.labelMap.set(e,i),this.align){case"center":this.addStackInline([i,e],0,this.align_padx,"center");break;case"fixed":i.setTextWidth(this.align_fix_start-this.padX-this.align_padx),this.addStack(i),e.pos(this.x+this.align_fix_start,i.y),this.addChild(e);break;case"none":this.addStack(i),e.posNext(i,this.align_padx),this.addChild(e)}},setLabelFocusColor:function(t,e){this.colorLabelFocus=null==t?null:{fg:t,bg:e}},onChildEvent:function(t,e){var i;"focus"==t?null!=(i=this.labelMap.h[e.__id__])&&(i.focusSetup(!0),i.draw()):"unfocus"==t&&null!=(i=this.labelMap.h[e.__id__])&&(i.focusSetup(!1),i.draw()),B.prototype.onChildEvent.call(this,t,e)},addQ:function(t,e){function i(t){return v.parseInt(r[t])}function s(t){return parseFloat(r[t])}var n=null,r=e.split(","),o=this.width-this.align_fix_start-this.padX;switch(r[0]){case"button":n=new Q(r[1],r[2],i(3),1==i(4)?o:0);break;case"input":n=new it(r[1],"fixed"==this.align?o-1:0,r[2]);break;case"label":n=new V(r[1],1==i(2)?o:0,r[3]);break;case"popOpt":n=new Z(r[1],r[2].split("|"),i(3),i(4));break;case"slNum":n=new $(r[1],i(2),i(3),s(4),s(5));break;case"slOpt":n=new tt(r[1],r[2].split("|"),i(3));break;case"toggle":n=new st(r[1],"true"==r[2]);break;default:throw ct.thrown("Unsupported")}return this.add(t,n),n},__class__:lt});function ht(){}ht.__name__="haxe.IMap",ht.__isInterface__=!0;var ct=function(t,e,i){Error.call(this,t),this.message=t,this.__previousException=e,this.__nativeException=null!=i?i:this};ct.__name__="haxe.Exception",ct.caught=function(t){return t instanceof ct?t:t instanceof Error?new ct(t.message,null,t):new _t(t,null,t)},ct.thrown=function(t){return t instanceof ct?t.get_native():t instanceof Error?t:new _t(t)},ct.__super__=Error,ct.prototype=i(Error.prototype,{unwrap:function(){return this.__nativeException},get_native:function(){return this.__nativeException},__class__:ct,__properties__:{get_native:"get_native"}});var ut=function(t){var e=this;this.id=setInterval(function(){e.run()},t)};ut.__name__="haxe.Timer",ut.delay=function(t,e){var i=new ut(e);return i.run=function(){i.stop(),t()},i},ut.prototype={stop:function(){null!=this.id&&(clearInterval(this.id),this.id=null)},run:function(){},__class__:ut};var _t=function(t,e,i){ct.call(this,String(t),e,i),this.value=t};_t.__name__="haxe.ValueException",_t.__super__=ct,_t.prototype=i(ct.prototype,{unwrap:function(){return this.value},__class__:_t});function dt(){}dt.__name__="haxe.ds.BalancedTree",dt.__interfaces__=[ht],dt.prototype={set:function(t,e){this.root=this.setLoop(t,e,this.root)},get:function(t){for(var e=this.root;null!=e;){var i=this.compare(t,e.key);if(0==i)return e.value;e=i<0?e.left:e.right}return null},setLoop:function(t,e,i){if(null==i)return new ft(null,t,e,null);var s=this.compare(t,i.key);if(0==s)return new ft(i.left,t,e,i.right,null==i?0:i._height);if(s<0){var n=this.setLoop(t,e,i.left);return this.balance(n,i.key,i.value,i.right)}var r=this.setLoop(t,e,i.right);return this.balance(i.left,i.key,i.value,r)},balance:function(t,e,i,s){var n=null==t?0:t._height,r=null==s?0:s._height;if(r+2<n){var o=t.left,a=t.right;return(null==o?0:o._height)>=(null==a?0:a._height)?new ft(t.left,t.key,t.value,new ft(t.right,e,i,s)):new ft(new ft(t.left,t.key,t.value,t.right.left),t.right.key,t.right.value,new ft(t.right.right,e,i,s))}if(n+2<r){o=s.right,a=s.left;return(null==o?0:o._height)>(null==a?0:a._height)?new ft(new ft(t,e,i,s.left),s.key,s.value,s.right):new ft(new ft(t,e,i,s.left.left),s.left.key,s.left.value,new ft(s.left.right,s.key,s.value,s.right))}return new ft(t,e,i,s,(r<n?n:r)+1)},compare:function(t,e){return _.compare(t,e)},__class__:dt};var ft=function(t,e,i,s,n){var r,o,a;null==n&&(n=-1),this.left=t,this.key=e,this.value=i,this.right=s,-1==n?(a=this.left,r=this.right,o=(null==a?0:a._height)>(null==r?0:r._height)?null==(a=this.left)?0:a._height:null==(a=this.right)?0:a._height,this._height=o+1):this._height=n};ft.__name__="haxe.ds.TreeNode",ft.prototype={__class__:ft};var pt=function(){dt.call(this)};pt.__name__="haxe.ds.EnumValueMap",pt.__interfaces__=[ht],pt.__super__=dt,pt.prototype=i(dt.prototype,{compare:function(t,e){var i=t._hx_index-e._hx_index;if(0!=i)return i;var s=p.enumParameters(t),n=p.enumParameters(e);return 0==s.length&&0==n.length?0:this.compareArgs(s,n)},compareArgs:function(t,e){var i=t.length-e.length;if(0!=i)return i;for(var s=0,n=t.length;s<n;){var r=s++,o=this.compareArg(t[r],e[r]);if(0!=o)return o}return 0},compareArg:function(t,e){return _.isEnumValue(t)&&_.isEnumValue(e)?this.compare(t,e):t instanceof Array&&e instanceof Array?this.compareArgs(t,e):_.compare(t,e)},__class__:pt});var gt=function(){this.h={__keys__:{}}};gt.__name__="haxe.ds.ObjectMap",gt.__interfaces__=[ht],gt.prototype={set:function(t,e){var i=t.__id__;null==i&&(i=t.__id__=s.$haxeUID++),this.h[i]=e,this.h.__keys__[i]=t},__class__:gt};var mt=function(){this.h=Object.create(null)};mt.__name__="haxe.ds.StringMap",mt.__interfaces__=[ht],mt.keysIterator=function(t){var e=Object.keys(t),i=e.length,s=0;return{hasNext:function(){return s<i},next:function(){return e[(s+=1)-1]}}},mt.kvIterator=function(e){var i=Object.keys(e),t=i.length,s=0;return{hasNext:function(){return s<t},next:function(){var t=i[(s+=1)-1];return{key:t,value:e[t]}}}},mt.prototype={__class__:mt};f["haxe.io.Encoding"]={__ename__:!0,__constructs__:["UTF8","RawNative"],UTF8:{_hx_index:0,__enum__:"haxe.io.Encoding",toString:e},RawNative:{_hx_index:1,__enum__:"haxe.io.Encoding",toString:e}};var wt=function(){};wt.__name__="haxe.io.Eof",wt.prototype={toString:function(){return"Eof"},__class__:wt};var vt=f["haxe.io.Error"]={__ename__:!0,__constructs__:["Blocked","Overflow","OutsideBounds","Custom"],Blocked:{_hx_index:0,__enum__:"haxe.io.Error",toString:e},Overflow:{_hx_index:1,__enum__:"haxe.io.Error",toString:e},OutsideBounds:{_hx_index:2,__enum__:"haxe.io.Error",toString:e},Custom:((t=function(t){return{_hx_index:3,e:t,__enum__:"haxe.io.Error",toString:e}}).__params__=["e"],t)};var xt=function(){};xt.__name__="js.Boot",xt.getClass=function(t){if(null==t)return null;if(t instanceof Array)return Array;var e=t.__class__;if(null!=e)return e;var i=xt.__nativeClassName(t);return null!=i?xt.__resolveNativeClass(i):null},xt.__string_rec=function(n,r){if(null==n)return"null";if(5<=r.length)return"<...>";var t,e=typeof n;switch("function"==e&&(n.__name__||n.__ename__)&&(e="object"),e){case"function":return"<function>";case"object":if(n.__enum__){var i=f[n.__enum__],s=i.__constructs__[n._hx_index],o=i[s];return o.__params__?(r+="\t",s+"("+function(){for(var t=[],e=0,i=o.__params__;e<i.length;){var s=i[e];e+=1,t.push(xt.__string_rec(n[s],r))}return t}().join(",")+")"):s}if(n instanceof Array){var a="[";r+="\t";for(var l=0,h=n.length;l<h;){var c=l++;a+=(0<c?",":"")+xt.__string_rec(n[c],r)}return a+="]"}try{t=n.toString}catch(l){return"???"}if(null!=t&&t!=Object.toString&&"function"==typeof t){var u=n.toString();if("[object Object]"!=u)return u}a="{\n";r+="\t";var _=null!=n.hasOwnProperty,d=null;for(d in n)_&&!n.hasOwnProperty(d)||"prototype"!=d&&"__class__"!=d&&"__super__"!=d&&"__interfaces__"!=d&&"__properties__"!=d&&(2!=a.length&&(a+=", \n"),a+=r+d+" : "+xt.__string_rec(n[d],r));return a+="\n"+(r=r.substring(1))+"}";case"string":return n;default:return String(n)}},xt.__interfLoop=function(t,e){if(null==t)return!1;if(t==e)return!0;var i=t.__interfaces__;if(null!=i)for(var s=0,n=i.length;s<n;){var r=i[s++];if(r==e||xt.__interfLoop(r,e))return!0}return xt.__interfLoop(t.__super__,e)},xt.__instanceof=function(t,e){if(null==e)return!1;switch(e){case Array:return t instanceof Array;case Gt:return"boolean"==typeof t;case Ct:return null!=t;case Nt:return"number"==typeof t;case Ft:return"number"==typeof t&&(0|t)===t;case String:return"string"==typeof t;default:if(null==t)return!1;if("function"==typeof e){if(xt.__downcastCheck(t,e))return!0}else if("object"==typeof e&&xt.__isNativeObj(e)&&t instanceof e)return!0;return e==Lt&&null!=t.__name__?!0:e==jt&&null!=t.__ename__||null!=t.__enum__&&f[t.__enum__]==e}},xt.__downcastCheck=function(t,e){return t instanceof e||!!e.__isInterface__&&xt.__interfLoop(xt.getClass(t),e)},xt.__cast=function(t,e){if(null==t||xt.__instanceof(t,e))return t;throw ct.thrown("Cannot cast "+v.string(t)+" to "+v.string(e))},xt.__nativeClassName=function(t){var e=xt.__toStr.call(t).slice(8,-1);return"Object"==e||"Function"==e||"Math"==e||"JSON"==e?null:e},xt.__isNativeObj=function(t){return null!=xt.__nativeClassName(t)},xt.__resolveNativeClass=function(t){return s[t]};var yt=require("child_process"),bt=require("crypto"),St=require("fs"),Tt=require("os"),kt=require("path"),Et=require("buffer").Buffer,At=function(){};At.__name__="sys.FileSystem",At.exists=function(t){try{return St.accessSync(t),!0}catch(t){return!1}};function Ot(t){this.fd=t,this.pos=0}Ot.__name__="sys.io.FileInput",Ot.__super__=l,Ot.prototype=i(l.prototype,{readByte:function(){var t,e=Et.alloc(1);try{t=St.readSync(this.fd,e,0,1,this.pos)}catch(t){var i=ct.caught(t).unwrap();throw"EOF"==i.code?ct.thrown(new wt):ct.thrown(vt.Custom(i))}if(0==t)throw ct.thrown(new wt);return this.pos++,e[0]},readBytes:function(t,e,i){var s,n=t.b,r=Et.from(n.buffer,n.byteOffset,t.length);try{s=St.readSync(this.fd,r,e,i,this.pos)}catch(t){var o=ct.caught(t).unwrap();throw"EOF"==o.code?ct.thrown(new wt):ct.thrown(vt.Custom(o))}if(0==s)throw ct.thrown(new wt);return this.pos+=s,s},close:function(){St.closeSync(this.fd)},seek:function(t,e){switch(e._hx_index){case 0:this.pos=t;break;case 1:this.pos+=t;break;case 2:this.pos=St.fstatSync(this.fd).size+t}},tell:function(){return this.pos},eof:function(){return this.pos>=St.fstatSync(this.fd).size},__class__:Ot});function It(t){this.fd=t,this.pos=0}It.__name__="sys.io.FileOutput",It.__super__=n,It.prototype=i(n.prototype,{writeByte:function(t){var e=Et.alloc(1);e[0]=t,St.writeSync(this.fd,e,0,1,this.pos),this.pos++},writeBytes:function(t,e,i){var s=t.b,n=Et.from(s.buffer,s.byteOffset,t.length),r=St.writeSync(this.fd,n,e,i,this.pos);return this.pos+=r,r},close:function(){St.closeSync(this.fd)},seek:function(t,e){switch(e._hx_index){case 0:this.pos=t;break;case 1:this.pos+=t;break;case 2:this.pos=St.fstatSync(this.fd).size+t}},tell:function(){return this.pos},__class__:It});f["sys.io.FileSeek"]={__ename__:!0,__constructs__:["SeekBegin","SeekCur","SeekEnd"],SeekBegin:{_hx_index:0,__enum__:"sys.io.FileSeek",toString:e},SeekCur:{_hx_index:1,__enum__:"sys.io.FileSeek",toString:e},SeekEnd:{_hx_index:2,__enum__:"sys.io.FileSeek",toString:e}};function Dt(t,e){return null==e?null:(null==e.__id__&&(e.__id__=s.$haxeUID++),null==t.hx__closures__?t.hx__closures__={}:i=t.hx__closures__[e.__id__],null==i&&(i=e.bind(t),t.hx__closures__[e.__id__]=i),i);var i}s.$haxeUID|=0,"undefined"!=typeof performance&&"function"==typeof performance.now&&(w.now=performance.now.bind(performance)),null==String.fromCodePoint&&(String.fromCodePoint=function(t){return t<65536?String.fromCharCode(t):String.fromCharCode(55232+(t>>10))+String.fromCharCode(56320+(1023&t))}),String.prototype.__class__=String,String.__name__="String",Array.__name__="Array";var Ft={},Ct={},Nt=Number,Gt=Boolean,Lt={},jt={};gt.count=0,xt.__toStr={}.toString,u.NAME="Mednafen PSX Custom Launcher",u.VER="0.5.1",u.ext_normal=[".cue",".m3u"],u.ext_mountable=[".pfo",".zip",".cfs"],u.file_config="config.ini",u.file_config_empty="config_empty.ini",u.MEDNAFEN_EXE="mednafen.exe",u.PSX_CFG="psx.cfg",r.VERSION="0.6",r.LINE_LEN=40,o.WIDTH=80,o.HEIGHT=25,o.WIDTH_MIN=60,o.HEIGHT_MIN=22,o.STATUS_POPUP_TIME=3300,x.OVERFLOW_SMBL="-",y.FX="_",b.OBJEX_NUM_SYMBOL="#",b.STRING_TERMINATOR="\\e",b.FORCE_EMPTYLINES="\\l",b.NEWLINES=["\n","\r","r\n"],b.COMMENTS=["#",";"],b.NO_NEW_LINE="\\",b.reg_section=new c("^\\[([^\\]]+)\\]",""),b.reg_def=new c("^([^(){}:=]+)[:=](.*)",""),S.CTRLC="",S.ESC="",S.UP="[A",S.DOWN="[B",S.LEFT="[C",S.RIGHT="[D",S.BACKSP="\b",S.TAB="\t",S.ENTER="\r",S.DELETE="",k.FLAG_CAN_BREAK=!0,O.EXE="pfm.exe",D.messageTypes=["DEBUG","INFO","WARN","ERROR","FATAL"],D._isInited=!1,D.logLevel=0,D.flag_socket_log=!1,D.FLAG_SHOW_MESSAGE_TYPE=!1,D.FLAG_STDOUT=!1,D.BUFFER_SIZE=8e3,F.FLAG_LOG_QUIET=!0,G.UID_GEN=1,R.DEF_STYLE_WIN="blue.1",R.DEF_STYLE_POP="red.1",R.DEF_WINDOW_SIZE_X=20,R.DEF_WINDOW_SIZE_Y=8,P.NAME="djTui",P.VERSION="0.2",P.backgroundColor="black",P._isInited=!1,B.windowAnimationTick=90,Q.SMB=["[]","{}","()","<>"],Q.CONF_DEF="Are you sure?",Z.WIN_MIN_WIDTH=15,J.SYMBOL_BAR="│",J.SYMBOL_IND="█",it.DEFAULT_SIZE=12,it.DEFAULT_CARET="▄",it.CARET_BLINK_RATE=200,it.BANK_LETTERS="QAZWSXEDCRFVTGBYHNUJMIKOLPqazwsxedcrfvtgbyhnujmikolp",it.BANK_NUMBERS="1234567890",it.BANK_SYMBOLS=" `~!@#$%^&*()_+-=[]{}\\|;:'\",.<>/?",at.BUTTON_STYLE=1,at.FOCUS_LAST=!1,o.main()}("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this);